<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="LLM Prompt Studio Pro - Suite professionnelle complète pour la création, gestion et optimisation de prompts AI avec interface ultra-moderne inspirée de macOS et GitHub">
    <meta name="keywords" content="LLM, AI, Prompt Engineering, GPT, Claude, Gemini, Machine Learning, Studio Pro">
    <meta name="author" content="LLM Prompt Studio">
    <title>⚡ LLM Prompt Studio Pro | Ultimate Edition 2025</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='80' font-size='80'>⚡</text></svg>">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome Pro -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Lucide Icons -->
    <script defer src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- Prism.js for Syntax Highlighting - Lazy Loading -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" media="print" onload="this.media='all'">
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markdown.min.js"></script>
    
    <!-- Monaco Editor - Lazy Loading on Demand -->
    <script>
        window.loadMonacoEditor = function() {
            if (!window.monacoLoaded) {
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.min.js';
                script.onload = () => {
                    window.monacoLoaded = true;
                    require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs' }});
                };
                document.head.appendChild(script);
            }
        };
    </script>
    
    <!-- Chart.js - Lazy Loading -->
    <script defer src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Marked.js for Markdown -->
    <script defer src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <!-- DOMPurify for XSS Protection -->
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.6/purify.min.js"></script>
    
    <!-- Sortable.js for Drag & Drop -->
    <script defer src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    
    <!-- Hotkeys.js -->
    <script defer src="https://unpkg.com/hotkeys-js/dist/hotkeys.min.js"></script>
    
    <style>
        /* ============================================
           DESIGN SYSTEM & VARIABLES
           ============================================ */
        :root {
            /* macOS/GitHub Inspired Color Palette */
            --primary-50: #eff6ff;
            --primary-100: #dbeafe;
            --primary-200: #bfdbfe;
            --primary-300: #93bbfc;
            --primary-400: #60a5fa;
            --primary-500: #3b82f6;
            --primary-600: #2563eb;
            --primary-700: #1d4ed8;
            --primary-800: #1e40af;
            --primary-900: #1e3a8a;
            
            /* Semantic Colors */
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #06b6d4;
            
            /* Neutral Colors */
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --gray-950: #030712;
            
            /* Surface Colors - Light Theme */
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --bg-tertiary: #f3f4f6;
            --surface: #ffffff;
            --surface-hover: #f9fafb;
            --surface-active: #f3f4f6;
            --overlay: rgba(0, 0, 0, 0.5);
            
            /* Text Colors - Light Theme */
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --text-tertiary: #9ca3af;
            --text-inverse: #ffffff;
            
            /* Border & Divider */
            --border: #e5e7eb;
            --border-hover: #d1d5db;
            --border-focus: #3b82f6;
            --divider: rgba(0, 0, 0, 0.06);
            
            /* Shadows - macOS Style */
            --shadow-xs: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            --shadow-inner: inset 0 2px 4px 0 rgba(0, 0, 0, 0.05);
            
            /* macOS Window Shadow */
            --shadow-window: 0 0 0 0.5px rgba(0, 0, 0, 0.1), 
                           0 2px 5px rgba(0, 0, 0, 0.05), 
                           0 10px 40px rgba(0, 0, 0, 0.15);
            
            /* Glows */
            --glow-primary: 0 0 20px rgba(59, 130, 246, 0.5);
            --glow-success: 0 0 20px rgba(16, 185, 129, 0.5);
            --glow-danger: 0 0 20px rgba(239, 68, 68, 0.5);
            
            /* Border Radius */
            --radius-xs: 0.125rem;
            --radius-sm: 0.25rem;
            --radius-md: 0.375rem;
            --radius-lg: 0.5rem;
            --radius-xl: 0.75rem;
            --radius-2xl: 1rem;
            --radius-3xl: 1.5rem;
            --radius-full: 9999px;
            
            /* Spacing */
            --space-xs: 0.25rem;
            --space-sm: 0.5rem;
            --space-md: 1rem;
            --space-lg: 1.5rem;
            --space-xl: 2rem;
            --space-2xl: 3rem;
            --space-3xl: 4rem;
            
            /* Typography */
            --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            --font-mono: 'JetBrains Mono', 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', monospace;
            --font-display: 'Space Grotesk', var(--font-sans);
            
            /* Font Sizes */
            --text-xs: 0.75rem;
            --text-sm: 0.875rem;
            --text-base: 1rem;
            --text-lg: 1.125rem;
            --text-xl: 1.25rem;
            --text-2xl: 1.5rem;
            --text-3xl: 1.875rem;
            --text-4xl: 2.25rem;
            --text-5xl: 3rem;
            
            /* Line Heights */
            --leading-tight: 1.25;
            --leading-snug: 1.375;
            --leading-normal: 1.5;
            --leading-relaxed: 1.625;
            --leading-loose: 2;
            
            /* Transitions */
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-base: 250ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slower: 500ms cubic-bezier(0.4, 0, 0.2, 1);
            
            /* Animations */
            --ease-bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);
            --ease-smooth: cubic-bezier(0.4, 0, 0.2, 1);
            --ease-in-out-back: cubic-bezier(0.68, -0.6, 0.32, 1.6);
            
            /* Z-index Scale */
            --z-dropdown: 1000;
            --z-sticky: 1020;
            --z-fixed: 1030;
            --z-modal-backdrop: 1040;
            --z-modal: 1050;
            --z-popover: 1060;
            --z-tooltip: 1070;
            --z-notification: 1080;
            
            /* Blur Effects */
            --blur-sm: 4px;
            --blur-md: 8px;
            --blur-lg: 16px;
            --blur-xl: 24px;
            
            /* Backdrop Filters */
            --backdrop-blur: blur(20px) saturate(180%);
            --backdrop-blur-sm: blur(8px) saturate(180%);
            --backdrop-blur-md: blur(12px) saturate(180%);
            --backdrop-blur-lg: blur(16px) saturate(180%);
        }
        
        /* Dark Theme Variables */
        [data-theme="dark"] {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --surface: #161b22;
            --surface-hover: #21262d;
            --surface-active: #30363d;
            --overlay: rgba(0, 0, 0, 0.7);
            
            --text-primary: #f0f6fc;
            --text-secondary: #8b949e;
            --text-tertiary: #6e7681;
            --text-inverse: #0d1117;
            
            --border: #30363d;
            --border-hover: #484f58;
            --divider: rgba(255, 255, 255, 0.08);
            
            --shadow-xs: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
            --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.4), 0 1px 2px -1px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.4), 0 2px 4px -2px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.5), 0 4px 6px -4px rgba(0, 0, 0, 0.4);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.5), 0 8px 10px -6px rgba(0, 0, 0, 0.4);
            --shadow-window: 0 0 0 0.5px rgba(255, 255, 255, 0.05), 
                           0 2px 5px rgba(0, 0, 0, 0.3), 
                           0 10px 40px rgba(0, 0, 0, 0.5);
        }
        
        /* ============================================
           RESET & BASE STYLES
           ============================================ */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        html {
            font-size: 16px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
            scroll-behavior: smooth;
        }
        
        body {
            font-family: var(--font-sans);
            font-size: var(--text-base);
            line-height: var(--leading-normal);
            color: var(--text-primary);
            background: var(--bg-primary);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
            transition: background-color var(--transition-base), color var(--transition-base);
        }

        /* ============================================
           ANIMATIONS AVANCÉES
           ============================================ */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        @keyframes shimmer {
            0% {
                background-position: -1000px 0;
            }
            100% {
                background-position: 1000px 0;
            }
        }

        @keyframes glow {
            0%, 100% {
                box-shadow: 0 0 5px rgba(59, 130, 246, 0.5);
            }
            50% {
                box-shadow: 0 0 20px rgba(59, 130, 246, 0.8), 0 0 30px rgba(59, 130, 246, 0.6);
            }
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        @keyframes ripple {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            100% {
                transform: scale(4);
                opacity: 0;
            }
        }

        .animate-fadeIn {
            animation: fadeInUp 0.5s ease-out;
        }

        .animate-slideIn {
            animation: slideInLeft 0.3s ease-out;
        }

        .animate-pulse {
            animation: pulse 2s infinite;
        }

        .animate-float {
            animation: float 3s ease-in-out infinite;
        }

        /* Loading Skeleton */
        .skeleton {
            background: linear-gradient(
                90deg,
                var(--gray-200) 25%,
                var(--gray-100) 50%,
                var(--gray-200) 75%
            );
            background-size: 1000px 100%;
            animation: shimmer 2s infinite;
            border-radius: var(--radius-md);
        }

        /* Smooth Transitions */
        .transition-all {
            transition: all var(--transition-base);
        }

        .transition-transform {
            transition: transform var(--transition-fast);
        }

        .transition-colors {
            transition: color var(--transition-fast), background-color var(--transition-fast), border-color var(--transition-fast);
        }

        /* ============================================
           ENHANCED UI COMPONENTS
           ============================================ */
        
        /* Dynamic Prompts Section */
        .dynamic-prompts {
            margin-top: var(--space-lg);
        }

        .prompts-filter-bar {
            padding: var(--space-sm);
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-sm);
        }

        .filter-select {
            width: 100%;
            padding: var(--space-xs) var(--space-sm);
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            font-size: var(--text-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .filter-select:hover {
            border-color: var(--border-hover);
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* Prompt List */
        .prompt-list {
            max-height: 400px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--gray-400) transparent;
        }

        .prompt-list::-webkit-scrollbar {
            width: 6px;
        }

        .prompt-list::-webkit-scrollbar-track {
            background: transparent;
        }

        .prompt-list::-webkit-scrollbar-thumb {
            background: var(--gray-400);
            border-radius: var(--radius-full);
        }

        /* Prompt Item */
        .prompt-item {
            display: flex;
            align-items: center;
            padding: var(--space-sm);
            margin-bottom: var(--space-xs);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            position: relative;
        }

        .prompt-item:hover {
            background: var(--surface-hover);
            transform: translateX(2px);
        }

        .prompt-item.active {
            background: var(--primary-50);
            color: var(--primary-600);
        }
        
        [data-theme="dark"] .prompt-item.active {
            background: rgba(59, 130, 246, 0.1);
        }

        .prompt-item-content {
            flex: 1;
            min-width: 0;
            margin-left: var(--space-sm);
        }

        .prompt-item-meta {
            display: block;
            font-size: var(--text-xs);
            color: var(--text-tertiary);
            margin-top: 2px;
        }

        .prompt-item-actions {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            opacity: 0;
            transition: opacity var(--transition-fast);
        }

        .prompt-item:hover .prompt-item-actions {
            opacity: 1;
        }

        /* Micro Button */
        .btn-micro {
            padding: 2px 6px;
            background: transparent;
            border: none;
            border-radius: var(--radius-sm);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .btn-micro:hover {
            background: var(--surface-hover);
            color: var(--text-primary);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: var(--space-xl);
            color: var(--text-tertiary);
        }

        /* Prompt Details */
        .prompt-details-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-md);
            padding-bottom: var(--space-md);
            border-bottom: 1px solid var(--border);
        }

        .prompt-details-meta {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-md);
            margin-bottom: var(--space-md);
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            font-size: var(--text-sm);
            color: var(--text-secondary);
        }

        .prompt-details-tags {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-xs);
            margin-bottom: var(--space-md);
        }

        .prompt-details-description {
            padding: var(--space-md);
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-md);
            line-height: var(--leading-relaxed);
        }

        .prompt-details-actions {
            display: flex;
            gap: var(--space-sm);
        }

        /* Form Controls */
        .form-group {
            margin-bottom: var(--space-md);
        }

        .form-group label {
            display: block;
            margin-bottom: var(--space-xs);
            font-weight: 500;
            font-size: var(--text-sm);
            color: var(--text-secondary);
        }

        .form-control {
            width: 100%;
            padding: var(--space-sm);
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            font-size: var(--text-base);
            transition: all var(--transition-fast);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        textarea.form-control {
            resize: vertical;
            min-height: 100px;
            font-family: var(--font-mono);
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: var(--space-sm);
            margin-top: var(--space-lg);
            padding-top: var(--space-lg);
            border-top: 1px solid var(--border);
        }

        /* Advanced Search */
        .advanced-search {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            padding: var(--space-md);
            margin-top: var(--space-sm);
            z-index: var(--z-dropdown);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all var(--transition-base);
        }

        .advanced-search.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        /* Real-time Indicators */
        .sync-indicator {
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            padding: var(--space-xs) var(--space-sm);
            background: var(--success);
            color: white;
            border-radius: var(--radius-full);
            font-size: var(--text-xs);
            animation: pulse 2s infinite;
        }

        .auto-save-indicator {
            position: fixed;
            bottom: var(--space-lg);
            right: var(--space-lg);
            padding: var(--space-sm) var(--space-md);
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            opacity: 0;
            transform: translateY(20px);
            transition: all var(--transition-base);
            z-index: var(--z-notification);
        }

        .auto-save-indicator.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* Selection */
        ::selection {
            background-color: var(--primary-200);
            color: var(--primary-900);
        }
        
        /* Scrollbar - macOS Style */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }
        
        ::-webkit-scrollbar-track {
            background: transparent;
            border-radius: var(--radius-full);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--gray-400);
            border-radius: var(--radius-full);
            border: 3px solid var(--bg-primary);
            background-clip: padding-box;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--gray-500);
        }
        
        ::-webkit-scrollbar-corner {
            background: transparent;
        }
        
        /* Focus Styles */
        :focus {
            outline: none;
        }
        
        :focus-visible {
            outline: 2px solid var(--primary-500);
            outline-offset: 2px;
            border-radius: var(--radius-sm);
        }
        
        /* ============================================
           LAYOUT STRUCTURE
           ============================================ */
        .app-wrapper {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            position: relative;
            background: var(--bg-primary);
        }
        
        /* macOS Style Window Frame */
        .window-frame {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 32px;
            background: linear-gradient(180deg, var(--bg-secondary) 0%, transparent 100%);
            backdrop-filter: var(--backdrop-blur);
            -webkit-backdrop-filter: var(--backdrop-blur);
            z-index: var(--z-fixed);
            display: flex;
            align-items: center;
            padding: 0 var(--space-md);
            border-bottom: 1px solid var(--border);
        }
        
        .window-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .window-control {
            width: 12px;
            height: 12px;
            border-radius: var(--radius-full);
            border: 0.5px solid rgba(0, 0, 0, 0.12);
            cursor: pointer;
            transition: all var(--transition-fast);
            position: relative;
        }
        
        .window-control.close {
            background: #ff5f57;
        }
        
        .window-control.minimize {
            background: #ffbd2e;
        }
        
        .window-control.maximize {
            background: #28ca42;
        }
        
        .window-control:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .window-title {
            flex: 1;
            text-align: center;
            font-size: var(--text-sm);
            font-weight: 500;
            color: var(--text-secondary);
            user-select: none;
            font-family: var(--font-display);
        }
        
        /* Main Header */
        .main-header {
            position: fixed;
            top: 32px;
            left: 0;
            right: 0;
            height: 64px;
            background: var(--bg-primary);
            backdrop-filter: var(--backdrop-blur);
            -webkit-backdrop-filter: var(--backdrop-blur);
            border-bottom: 1px solid var(--border);
            z-index: var(--z-sticky);
            display: flex;
            align-items: center;
            padding: 0 var(--space-xl);
            gap: var(--space-lg);
            box-shadow: var(--shadow-sm);
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            cursor: pointer;
            transition: all var(--transition-base);
        }
        
        .logo-container:hover {
            transform: translateX(4px);
        }
        
        .logo-icon {
            width: 42px;
            height: 42px;
            background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-700) 100%);
            border-radius: var(--radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-xl);
            font-weight: 700;
            color: white;
            box-shadow: var(--shadow-lg), var(--glow-primary);
            position: relative;
            overflow: hidden;
        }
        
        .logo-icon::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transform: rotate(45deg);
            animation: logoShine 3s ease-in-out infinite;
        }
        
        @keyframes logoShine {
            0%, 100% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            50% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        
        .logo-text {
            display: flex;
            flex-direction: column;
        }
        
        .logo-title {
            font-size: var(--text-lg);
            font-weight: 700;
            font-family: var(--font-display);
            background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-400) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.02em;
        }
        
        .logo-subtitle {
            font-size: var(--text-xs);
            color: var(--text-tertiary);
            font-weight: 500;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }
        
        /* Navigation Tabs - GitHub Style */
        .nav-tabs {
            display: flex;
            gap: var(--space-xs);
            flex: 1;
            max-width: 600px;
        }
        
        .nav-tab {
            padding: var(--space-sm) var(--space-lg);
            font-size: var(--text-sm);
            font-weight: 500;
            color: var(--text-secondary);
            background: transparent;
            border: none;
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all var(--transition-base);
            position: relative;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            white-space: nowrap;
        }
        
        .nav-tab:hover {
            color: var(--text-primary);
            background: var(--surface-hover);
        }
        
        .nav-tab.active {
            color: var(--primary-600);
            background: var(--primary-50);
        }
        
        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: var(--space-md);
            right: var(--space-md);
            height: 2px;
            background: var(--primary-500);
            border-radius: var(--radius-full);
        }
        
        .nav-tab-icon {
            width: 16px;
            height: 16px;
        }
        
        .nav-tab-badge {
            padding: 2px 6px;
            font-size: 10px;
            font-weight: 600;
            background: var(--primary-500);
            color: white;
            border-radius: var(--radius-full);
            margin-left: var(--space-xs);
        }
        
        /* Header Actions */
        .header-actions {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }
        
        .search-container {
            position: relative;
            width: 280px;
        }
        
        .search-input {
            width: 100%;
            padding: var(--space-sm) var(--space-md);
            padding-left: 36px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            font-size: var(--text-sm);
            color: var(--text-primary);
            transition: all var(--transition-base);
        }
        
        .search-input:hover {
            border-color: var(--border-hover);
        }
        
        .search-input:focus {
            border-color: var(--primary-500);
            background: var(--surface);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            width: 16px;
            height: 16px;
            color: var(--text-tertiary);
            pointer-events: none;
        }
        
        .search-shortcut {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            padding: 2px 6px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            font-size: 11px;
            font-weight: 500;
            color: var(--text-tertiary);
            font-family: var(--font-mono);
            pointer-events: none;
        }
        
        /* Action Buttons */
        .btn {
            padding: var(--space-sm) var(--space-lg);
            font-size: var(--text-sm);
            font-weight: 500;
            border-radius: var(--radius-lg);
            border: none;
            cursor: pointer;
            transition: all var(--transition-base);
            display: inline-flex;
            align-items: center;
            gap: var(--space-sm);
            position: relative;
            overflow: hidden;
            font-family: var(--font-sans);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-600) 100%);
            color: white;
            box-shadow: var(--shadow-sm), 0 1px 2px rgba(59, 130, 246, 0.2);
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-700) 100%);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md), 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        .btn-primary:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }
        
        .btn-secondary:hover {
            background: var(--surface-hover);
            border-color: var(--border-hover);
        }
        
        .btn-ghost {
            background: transparent;
            color: var(--text-secondary);
        }
        
        .btn-ghost:hover {
            background: var(--surface-hover);
            color: var(--text-primary);
        }
        
        .btn-icon {
            width: 36px;
            height: 36px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-lg);
        }
        
        .btn-group {
            display: flex;
            gap: var(--space-xs);
        }
        
        /* Status Indicator */
        .status-indicator {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-xs) var(--space-md);
            background: var(--success);
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
            color: white;
            border-radius: var(--radius-full);
            font-size: var(--text-xs);
            font-weight: 600;
            box-shadow: var(--shadow-sm), var(--glow-success);
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            background: white;
            border-radius: var(--radius-full);
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.8); }
        }
        
        /* Theme Toggle */
        .theme-toggle {
            position: relative;
            width: 44px;
            height: 24px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: var(--radius-full);
            cursor: pointer;
            transition: all var(--transition-base);
        }
        
        .theme-toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 18px;
            height: 18px;
            background: white;
            border-radius: var(--radius-full);
            transition: all var(--transition-base);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-sm);
        }
        
        [data-theme="dark"] .theme-toggle {
            background: var(--primary-600);
            border-color: var(--primary-500);
        }
        
        [data-theme="dark"] .theme-toggle-slider {
            left: 22px;
            background: var(--bg-primary);
        }
        
        /* ============================================
           MAIN CONTENT AREA
           ============================================ */
        .main-content {
            margin-top: 96px;
            display: flex;
            height: calc(100vh - 96px);
            overflow: hidden;
        }
        
        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            transition: all var(--transition-base);
            position: relative;
        }
        
        .sidebar.collapsed {
            width: 60px;
        }
        
        .sidebar-toggle {
            position: absolute;
            right: -12px;
            top: 20px;
            width: 24px;
            height: 24px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
            transition: all var(--transition-base);
            box-shadow: var(--shadow-sm);
        }
        
        .sidebar-toggle:hover {
            background: var(--primary-500);
            color: white;
            border-color: var(--primary-500);
            transform: scale(1.1);
        }
        
        .sidebar-header {
            padding: var(--space-lg);
            border-bottom: 1px solid var(--border);
        }
        
        .sidebar-title {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: var(--space-md);
        }
        
        .sidebar.collapsed .sidebar-title {
            display: none;
        }
        
        /* Sidebar Menu */
        .sidebar-menu {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-md);
        }
        
        .sidebar-section {
            margin-bottom: var(--space-xl);
        }
        
        .sidebar-section-title {
            font-size: var(--text-xs);
            font-weight: 600;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: var(--space-sm);
            padding: 0 var(--space-sm);
        }
        
        .sidebar.collapsed .sidebar-section-title {
            display: none;
        }
        
        .sidebar-item {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm) var(--space-md);
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: var(--radius-lg);
            font-size: var(--text-sm);
            font-weight: 500;
            transition: all var(--transition-fast);
            cursor: pointer;
            position: relative;
        }
        
        .sidebar-item:hover {
            background: var(--surface-hover);
            color: var(--text-primary);
        }
        
        .sidebar-item.active {
            background: var(--primary-50);
            color: var(--primary-600);
        }
        
        [data-theme="dark"] .sidebar-item.active {
            background: rgba(59, 130, 246, 0.1);
        }
        
        .sidebar-item-icon {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }
        
        .sidebar-item-text {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .sidebar.collapsed .sidebar-item-text {
            display: none;
        }
        
        .sidebar-item-badge {
            padding: 2px 8px;
            font-size: var(--text-xs);
            font-weight: 600;
            background: var(--primary-500);
            color: white;
            border-radius: var(--radius-full);
        }
        
        .sidebar.collapsed .sidebar-item-badge {
            display: none;
        }
        
        /* Workspace Area */
        .workspace {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: var(--bg-primary);
        }
        
        /* Workspace Header */
        .workspace-header {
            padding: var(--space-lg) var(--space-xl);
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--space-lg);
        }
        
        .workspace-title {
            font-size: var(--text-xl);
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }
        
        .workspace-title-icon {
            width: 24px;
            height: 24px;
            color: var(--primary-500);
        }
        
        .workspace-actions {
            display: flex;
            gap: var(--space-sm);
        }
        
        /* Tab Bar */
        .tab-bar {
            display: flex;
            align-items: center;
            padding: 0 var(--space-lg);
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            gap: var(--space-xs);
            overflow-x: auto;
            scrollbar-width: none;
        }
        
        .tab-bar::-webkit-scrollbar {
            display: none;
        }
        
        .tab {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm) var(--space-md);
            background: transparent;
            border: none;
            border-bottom: 2px solid transparent;
            color: var(--text-secondary);
            font-size: var(--text-sm);
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-base);
            white-space: nowrap;
            position: relative;
        }
        
        .tab:hover {
            color: var(--text-primary);
            background: var(--surface-hover);
        }
        
        .tab.active {
            color: var(--primary-600);
            border-bottom-color: var(--primary-500);
            background: var(--surface);
        }
        
        .tab-icon {
            width: 16px;
            height: 16px;
        }
        
        .tab-close {
            width: 16px;
            height: 16px;
            margin-left: var(--space-xs);
            color: var(--text-tertiary);
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .tab-close:hover {
            color: var(--danger);
        }
        
        .tab-add {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            color: var(--text-tertiary);
            cursor: pointer;
            transition: all var(--transition-base);
            border-radius: var(--radius-md);
        }
        
        .tab-add:hover {
            background: var(--surface-hover);
            color: var(--primary-500);
        }
        
        /* Editor Container */
        .editor-container {
            flex: 1;
            display: flex;
            overflow: hidden;
        }
        
        /* Main Editor */
        .editor-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .editor-toolbar {
            padding: var(--space-sm) var(--space-lg);
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: var(--space-md);
            flex-wrap: wrap;
        }
        
        .toolbar-group {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            padding: 0 var(--space-sm);
            border-right: 1px solid var(--border);
        }
        
        .toolbar-group:last-child {
            border-right: none;
        }
        
        .toolbar-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: var(--radius-md);
            transition: all var(--transition-fast);
            position: relative;
        }
        
        .toolbar-btn:hover {
            background: var(--surface-hover);
            color: var(--text-primary);
        }
        
        .toolbar-btn.active {
            background: var(--primary-50);
            color: var(--primary-600);
        }
        
        [data-theme="dark"] .toolbar-btn.active {
            background: rgba(59, 130, 246, 0.1);
        }
        
        .toolbar-separator {
            width: 1px;
            height: 24px;
            background: var(--border);
            margin: 0 var(--space-sm);
        }
        
        /* Monaco Editor Wrapper */
        .monaco-wrapper {
            flex: 1;
            position: relative;
            overflow: hidden;
        }
        
        #monaco-editor {
            width: 100%;
            height: 100%;
        }
        
        /* Editor Footer */
        .editor-footer {
            padding: var(--space-sm) var(--space-lg);
            background: var(--bg-secondary);
            border-top: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: var(--text-xs);
            color: var(--text-secondary);
        }
        
        .footer-left, .footer-right {
            display: flex;
            align-items: center;
            gap: var(--space-lg);
        }
        
        .footer-item {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }
        
        .footer-icon {
            width: 14px;
            height: 14px;
        }
        
        /* Right Panel */
        .right-panel {
            width: 320px;
            background: var(--bg-secondary);
            border-left: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            transition: all var(--transition-base);
        }
        
        .right-panel.collapsed {
            width: 0;
            overflow: hidden;
            border-left: none;
        }
        
        .panel-header {
            padding: var(--space-md) var(--space-lg);
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .panel-title {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .panel-close {
            width: 20px;
            height: 20px;
            color: var(--text-tertiary);
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .panel-close:hover {
            color: var(--text-primary);
        }
        
        .panel-tabs {
            display: flex;
            padding: 0 var(--space-lg);
            background: var(--surface);
            border-bottom: 1px solid var(--border);
        }
        
        .panel-tab {
            padding: var(--space-sm) var(--space-md);
            font-size: var(--text-sm);
            font-weight: 500;
            color: var(--text-secondary);
            background: transparent;
            border: none;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            transition: all var(--transition-base);
        }
        
        .panel-tab:hover {
            color: var(--text-primary);
        }
        
        .panel-tab.active {
            color: var(--primary-600);
            border-bottom-color: var(--primary-500);
        }
        
        .panel-content {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-lg);
        }
        
        /* ============================================
           CARDS & COMPONENTS
           ============================================ */
        .card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-xl);
            padding: var(--space-lg);
            box-shadow: var(--shadow-sm);
            transition: all var(--transition-base);
        }
        
        .card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-md);
        }
        
        .card-title {
            font-size: var(--text-lg);
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .card-subtitle {
            font-size: var(--text-sm);
            color: var(--text-secondary);
            margin-top: var(--space-xs);
        }
        
        .card-body {
            color: var(--text-secondary);
            line-height: var(--leading-relaxed);
        }
        
        .card-footer {
            margin-top: var(--space-lg);
            padding-top: var(--space-md);
            border-top: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        /* Stats Card */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-md);
            margin-bottom: var(--space-xl);
        }
        
        .stat-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            display: flex;
            align-items: center;
            gap: var(--space-md);
            transition: all var(--transition-base);
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .stat-icon {
            width: 48px;
            height: 48px;
            background: var(--primary-50);
            color: var(--primary-600);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .stat-content {
            flex: 1;
        }
        
        .stat-label {
            font-size: var(--text-sm);
            color: var(--text-tertiary);
            margin-bottom: var(--space-xs);
        }
        
        .stat-value {
            font-size: var(--text-2xl);
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .stat-change {
            font-size: var(--text-sm);
            color: var(--success);
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            margin-top: var(--space-xs);
        }
        
        .stat-change.negative {
            color: var(--danger);
        }
        
        /* Prompt Card */
        .prompt-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-xl);
            padding: var(--space-lg);
            margin-bottom: var(--space-md);
            transition: all var(--transition-base);
            cursor: pointer;
        }
        
        .prompt-card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateX(4px);
            border-color: var(--primary-200);
        }
        
        .prompt-card.selected {
            border-color: var(--primary-500);
            background: var(--primary-50);
        }
        
        [data-theme="dark"] .prompt-card.selected {
            background: rgba(59, 130, 246, 0.05);
        }
        
        .prompt-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: var(--space-md);
        }
        
        .prompt-title {
            font-size: var(--text-base);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--space-xs);
        }
        
        .prompt-meta {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            font-size: var(--text-sm);
            color: var(--text-tertiary);
        }
        
        .prompt-meta-item {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }
        
        .prompt-actions {
            display: flex;
            gap: var(--space-xs);
        }
        
        .prompt-content {
            font-size: var(--text-sm);
            color: var(--text-secondary);
            line-height: var(--leading-relaxed);
            margin-bottom: var(--space-md);
        }
        
        .prompt-tags {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-xs);
        }
        
        .tag {
            padding: var(--space-xs) var(--space-sm);
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border-radius: var(--radius-md);
            font-size: var(--text-xs);
            font-weight: 500;
            transition: all var(--transition-fast);
        }
        
        .tag:hover {
            background: var(--primary-100);
            color: var(--primary-700);
        }
        
        /* ============================================
           MODALS & OVERLAYS
           ============================================ */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--overlay);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            z-index: var(--z-modal-backdrop);
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-base);
        }
        
        .modal-backdrop.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-2xl);
            z-index: var(--z-modal);
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-base);
            max-width: 90vw;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .modal.active {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }
        
        .modal-header {
            padding: var(--space-lg);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .modal-title {
            font-size: var(--text-xl);
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .modal-close {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            color: var(--text-tertiary);
            cursor: pointer;
            border-radius: var(--radius-lg);
            transition: all var(--transition-fast);
        }
        
        .modal-close:hover {
            background: var(--surface-hover);
            color: var(--text-primary);
        }
        
        .modal-body {
            padding: var(--space-xl);
            overflow-y: auto;
            flex: 1;
        }
        
        .modal-footer {
            padding: var(--space-lg);
            border-top: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: var(--space-md);
        }
        
        /* ============================================
           FORMS & INPUTS
           ============================================ */
        .form-group {
            margin-bottom: var(--space-lg);
        }
        
        .form-label {
            display: block;
            margin-bottom: var(--space-sm);
            font-size: var(--text-sm);
            font-weight: 500;
            color: var(--text-primary);
        }
        
        .form-label-required::after {
            content: '*';
            color: var(--danger);
            margin-left: var(--space-xs);
        }
        
        .form-input {
            width: 100%;
            padding: var(--space-sm) var(--space-md);
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            font-size: var(--text-sm);
            color: var(--text-primary);
            transition: all var(--transition-base);
        }
        
        .form-input:hover {
            border-color: var(--border-hover);
        }
        
        .form-input:focus {
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .form-input::placeholder {
            color: var(--text-tertiary);
        }
        
        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 16 16' fill='none' stroke='%236b7280' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M4 6l4 4 4-4'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 40px;
        }
        
        .form-checkbox-group,
        .form-radio-group {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }
        
        .form-checkbox-wrapper,
        .form-radio-wrapper {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }
        
        .form-checkbox,
        .form-radio {
            width: 20px;
            height: 20px;
            accent-color: var(--primary-500);
            cursor: pointer;
        }
        
        .form-helper {
            margin-top: var(--space-xs);
            font-size: var(--text-sm);
            color: var(--text-tertiary);
        }
        
        .form-error {
            margin-top: var(--space-xs);
            font-size: var(--text-sm);
            color: var(--danger);
        }
        
        /* Switch Toggle */
        .switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 24px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .switch-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--gray-300);
            transition: all var(--transition-base);
            border-radius: var(--radius-full);
        }
        
        .switch-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background: white;
            transition: all var(--transition-base);
            border-radius: var(--radius-full);
            box-shadow: var(--shadow-sm);
        }
        
        .switch input:checked + .switch-slider {
            background: var(--primary-500);
        }
        
        .switch input:checked + .switch-slider:before {
            transform: translateX(24px);
        }
        
        /* ============================================
           TOOLTIPS & POPOVERS
           ============================================ */
        .tooltip {
            position: relative;
        }
        
        .tooltip-content {
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            padding: var(--space-sm) var(--space-md);
            background: var(--gray-900);
            color: white;
            font-size: var(--text-xs);
            font-weight: 500;
            border-radius: var(--radius-lg);
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-fast);
            z-index: var(--z-tooltip);
            pointer-events: none;
        }
        
        .tooltip-content::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 4px solid transparent;
            border-top-color: var(--gray-900);
        }
        
        .tooltip:hover .tooltip-content {
            opacity: 1;
            visibility: visible;
        }
        
        /* ============================================
           ANIMATIONS & TRANSITIONS
           ============================================ */
        @keyframes slideInUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes slideInDown {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes slideInLeft {
            from {
                transform: translateX(-20px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(20px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        @keyframes scaleIn {
            from {
                transform: scale(0.9);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        @keyframes spin {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }
        
        .animate-slideInUp {
            animation: slideInUp var(--transition-base) ease-out;
        }
        
        .animate-slideInDown {
            animation: slideInDown var(--transition-base) ease-out;
        }
        
        .animate-fadeIn {
            animation: fadeIn var(--transition-base) ease-out;
        }
        
        .animate-scaleIn {
            animation: scaleIn var(--transition-base) var(--ease-bounce);
        }
        
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        
        /* Loading Spinner */
        .spinner {
            width: 24px;
            height: 24px;
            border: 2px solid var(--border);
            border-top-color: var(--primary-500);
            border-radius: var(--radius-full);
            animation: spin 0.8s linear infinite;
        }
        
        .spinner-lg {
            width: 48px;
            height: 48px;
            border-width: 4px;
        }
        
        /* Progress Bar */
        .progress {
            width: 100%;
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-full);
            overflow: hidden;
            position: relative;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-500) 0%, var(--primary-600) 100%);
            border-radius: var(--radius-full);
            transition: width var(--transition-slow) ease-out;
            position: relative;
            overflow: hidden;
        }
        
        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s linear infinite;
        }
        
        @keyframes shimmer {
            from {
                transform: translateX(-100%);
            }
            to {
                transform: translateX(100%);
            }
        }
        
        /* ============================================
           NOTIFICATIONS & TOASTS
           ============================================ */
        .toast-container {
            position: fixed;
            top: var(--space-xl);
            right: var(--space-xl);
            z-index: var(--z-notification);
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
            pointer-events: none;
        }
        
        .toast {
            min-width: 320px;
            padding: var(--space-md) var(--space-lg);
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            display: flex;
            align-items: center;
            gap: var(--space-md);
            pointer-events: auto;
            animation: slideInRight var(--transition-base) ease-out;
        }
        
        .toast-icon {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }
        
        .toast-success .toast-icon {
            color: var(--success);
        }
        
        .toast-error .toast-icon {
            color: var(--danger);
        }
        
        .toast-warning .toast-icon {
            color: var(--warning);
        }
        
        .toast-info .toast-icon {
            color: var(--info);
        }
        
        .toast-content {
            flex: 1;
        }
        
        .toast-title {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--space-xs);
        }
        
        .toast-message {
            font-size: var(--text-sm);
            color: var(--text-secondary);
        }
        
        .toast-close {
            width: 20px;
            height: 20px;
            color: var(--text-tertiary);
            cursor: pointer;
            flex-shrink: 0;
            transition: all var(--transition-fast);
        }
        
        .toast-close:hover {
            color: var(--text-primary);
        }
        
        /* ============================================
           UTILITIES
           ============================================ */
        .hidden {
            display: none !important;
        }
        
        .invisible {
            visibility: hidden !important;
        }
        
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
        
        .truncate {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .text-center {
            text-align: center;
        }
        
        .text-right {
            text-align: right;
        }
        
        .font-mono {
            font-family: var(--font-mono);
        }
        
        .font-bold {
            font-weight: 700;
        }
        
        .uppercase {
            text-transform: uppercase;
        }
        
        /* ============================================
           RESPONSIVE DESIGN
           ============================================ */
        @media (max-width: 1280px) {
            .right-panel {
                width: 280px;
            }
        }
        
        @media (max-width: 1024px) {
            .sidebar {
                position: fixed;
                left: -280px;
                height: 100vh;
                z-index: var(--z-fixed);
                box-shadow: var(--shadow-xl);
            }
            
            .sidebar.open {
                left: 0;
            }
            
            .sidebar-toggle {
                display: block;
            }
            
            .nav-tabs {
                display: none;
            }
            
            .search-container {
                width: 200px;
            }
        }
        
        @media (max-width: 768px) {
            .main-header {
                padding: 0 var(--space-md);
            }
            
            .header-actions {
                flex-wrap: wrap;
            }
            
            .workspace-header {
                padding: var(--space-md);
            }
            
            .editor-toolbar {
                padding: var(--space-sm) var(--space-md);
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .right-panel {
                position: fixed;
                right: -320px;
                height: 100vh;
                z-index: var(--z-fixed);
                box-shadow: var(--shadow-xl);
            }
            
            .right-panel.open {
                right: 0;
            }
        }
        
        @media (max-width: 480px) {
            .window-frame {
                display: none;
            }
            
            .main-header {
                top: 0;
            }
            
            .main-content {
                margin-top: 64px;
                height: calc(100vh - 64px);
            }
            
            .logo-subtitle {
                display: none;
            }
            
            .search-container {
                display: none;
            }
            
            .toast-container {
                left: var(--space-md);
                right: var(--space-md);
                top: var(--space-md);
            }
            
            .toast {
                min-width: auto;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- App Wrapper -->
    <div class="app-wrapper">
        <!-- macOS Style Window Frame -->
        <div class="window-frame">
            <div class="window-controls">
                <div class="window-control close"></div>
                <div class="window-control minimize"></div>
                <div class="window-control maximize"></div>
            </div>
            <div class="window-title">LLM Prompt Studio Pro — Ultimate Edition 2025</div>
        </div>
        
        <!-- Main Header -->
        <header class="main-header">
            <div class="logo-container">
                <div class="logo-icon">⚡</div>
                <div class="logo-text">
                    <div class="logo-title">LLM Prompt Studio Pro</div>
                    <div class="logo-subtitle">Ultimate Edition 2025</div>
                </div>
            </div>
            
            <!-- Navigation Tabs -->
            <nav class="nav-tabs">
                <button class="nav-tab active" data-tab="workspace">
                    <i class="fas fa-laptop-code nav-tab-icon"></i>
                    <span>Workspace</span>
                    <span class="nav-tab-badge">3</span>
                </button>
                <button class="nav-tab" data-tab="library">
                    <i class="fas fa-book nav-tab-icon"></i>
                    <span>Library</span>
                </button>
                <button class="nav-tab" data-tab="analytics">
                    <i class="fas fa-chart-line nav-tab-icon"></i>
                    <span>Analytics</span>
                </button>
                <button class="nav-tab" data-tab="models">
                    <i class="fas fa-robot nav-tab-icon"></i>
                    <span>Models</span>
                </button>
                <button class="nav-tab" data-tab="team">
                    <i class="fas fa-users nav-tab-icon"></i>
                    <span>Team</span>
                </button>
            </nav>
            
            <!-- Header Actions -->
            <div class="header-actions">
                <!-- Search -->
                <div class="search-container">
                    <input type="text" class="search-input" placeholder="Search prompts..." />
                    <i class="fas fa-search search-icon"></i>
                    <span class="search-shortcut">⌘K</span>
                </div>
                
                <!-- Action Buttons -->
                <div class="btn-group">
                    <button class="btn btn-ghost btn-icon tooltip">
                        <i class="fas fa-bell"></i>
                        <span class="tooltip-content">Notifications</span>
                    </button>
                    <button class="btn btn-ghost btn-icon tooltip">
                        <i class="fas fa-cog"></i>
                        <span class="tooltip-content">Settings</span>
                    </button>
                </div>
                
                <!-- Theme Toggle -->
                <div class="theme-toggle" id="themeToggle">
                    <div class="theme-toggle-slider">
                        <i class="fas fa-sun" style="font-size: 10px;"></i>
                    </div>
                </div>
                
                <!-- Status Indicator -->
                <div class="status-indicator">
                    <span class="status-dot"></span>
                    <span>Online</span>
                </div>
                
                <!-- New Prompt Button -->
                <button class="btn btn-primary" id="newPromptBtn">
                    <i class="fas fa-plus"></i>
                    <span>New Prompt</span>
                </button>
            </div>
        </header>
        
        <!-- Main Content -->
        <main class="main-content">
            <!-- Sidebar -->
            <aside class="sidebar" id="sidebar">
                <div class="sidebar-toggle" id="sidebarToggle">
                    <i class="fas fa-chevron-left"></i>
                </div>
                
                <div class="sidebar-header">
                    <h3 class="sidebar-title">Explorer</h3>
                </div>
                
                <div class="sidebar-menu">
                    <!-- Projects Section -->
                    <div class="sidebar-section">
                        <div class="sidebar-section-title">Projects</div>
                        <a href="#" class="sidebar-item active">
                            <i class="fas fa-folder sidebar-item-icon"></i>
                            <span class="sidebar-item-text">GPT-4 Prompts</span>
                            <span class="sidebar-item-badge">12</span>
                        </a>
                        <a href="#" class="sidebar-item">
                            <i class="fas fa-folder sidebar-item-icon"></i>
                            <span class="sidebar-item-text">Claude 3 Prompts</span>
                            <span class="sidebar-item-badge">8</span>
                        </a>
                        <a href="#" class="sidebar-item">
                            <i class="fas fa-folder sidebar-item-icon"></i>
                            <span class="sidebar-item-text">Gemini Pro</span>
                            <span class="sidebar-item-badge">5</span>
                        </a>
                        <a href="#" class="sidebar-item">
                            <i class="fas fa-folder-plus sidebar-item-icon"></i>
                            <span class="sidebar-item-text">New Project</span>
                        </a>
                    </div>
                    
                    <!-- Quick Access -->
                    <div class="sidebar-section">
                        <div class="sidebar-section-title">Quick Access</div>
                        <a href="#" class="sidebar-item">
                            <i class="fas fa-star sidebar-item-icon"></i>
                            <span class="sidebar-item-text">Favorites</span>
                        </a>
                        <a href="#" class="sidebar-item">
                            <i class="fas fa-clock sidebar-item-icon"></i>
                            <span class="sidebar-item-text">Recent</span>
                        </a>
                        <a href="#" class="sidebar-item">
                            <i class="fas fa-share-alt sidebar-item-icon"></i>
                            <span class="sidebar-item-text">Shared</span>
                        </a>
                        <a href="#" class="sidebar-item">
                            <i class="fas fa-trash sidebar-item-icon"></i>
                            <span class="sidebar-item-text">Trash</span>
                        </a>
                    </div>
                    
                    <!-- Tools -->
                    <div class="sidebar-section">
                        <div class="sidebar-section-title">Tools</div>
                        <a href="#" class="sidebar-item">
                            <i class="fas fa-magic sidebar-item-icon"></i>
                            <span class="sidebar-item-text">AI Assistant</span>
                        </a>
                        <a href="#" class="sidebar-item">
                            <i class="fas fa-code sidebar-item-icon"></i>
                            <span class="sidebar-item-text">Code Generator</span>
                        </a>
                        <a href="#" class="sidebar-item">
                            <i class="fas fa-language sidebar-item-icon"></i>
                            <span class="sidebar-item-text">Translator</span>
                        </a>
                        <a href="#" class="sidebar-item">
                            <i class="fas fa-sliders-h sidebar-item-icon"></i>
                            <span class="sidebar-item-text">Parameters</span>
                        </a>
                    </div>
                </div>
            </aside>
            
            <!-- Workspace -->
            <div class="workspace">
                <!-- Workspace Header -->
                <div class="workspace-header">
                    <div class="workspace-title">
                        <i class="fas fa-folder-open workspace-title-icon"></i>
                        <span>GPT-4 Prompts</span>
                    </div>
                    <div class="workspace-actions">
                        <button class="btn btn-secondary">
                            <i class="fas fa-filter"></i>
                            <span>Filter</span>
                        </button>
                        <button class="btn btn-secondary">
                            <i class="fas fa-sort"></i>
                            <span>Sort</span>
                        </button>
                        <button class="btn btn-secondary">
                            <i class="fas fa-th"></i>
                            <span>View</span>
                        </button>
                    </div>
                </div>
                
                <!-- Tab Bar -->
                <div class="tab-bar">
                    <button class="tab active">
                        <i class="fas fa-file-alt tab-icon"></i>
                        <span>prompt_001.md</span>
                        <i class="fas fa-times tab-close"></i>
                    </button>
                    <button class="tab">
                        <i class="fas fa-file-alt tab-icon"></i>
                        <span>system_prompt.md</span>
                        <i class="fas fa-times tab-close"></i>
                    </button>
                    <button class="tab">
                        <i class="fas fa-file-alt tab-icon"></i>
                        <span>template.md</span>
                        <i class="fas fa-times tab-close"></i>
                    </button>
                    <button class="tab-add">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                
                <!-- Editor Container -->
                <div class="editor-container">
                    <!-- Main Editor -->
                    <div class="editor-main">
                        <!-- Editor Toolbar -->
                        <div class="editor-toolbar">
                            <div class="toolbar-group">
                                <button class="toolbar-btn tooltip">
                                    <i class="fas fa-undo"></i>
                                    <span class="tooltip-content">Undo</span>
                                </button>
                                <button class="toolbar-btn tooltip">
                                    <i class="fas fa-redo"></i>
                                    <span class="tooltip-content">Redo</span>
                                </button>
                            </div>
                            
                            <div class="toolbar-group">
                                <button class="toolbar-btn tooltip">
                                    <i class="fas fa-bold"></i>
                                    <span class="tooltip-content">Bold</span>
                                </button>
                                <button class="toolbar-btn tooltip">
                                    <i class="fas fa-italic"></i>
                                    <span class="tooltip-content">Italic</span>
                                </button>
                                <button class="toolbar-btn tooltip">
                                    <i class="fas fa-underline"></i>
                                    <span class="tooltip-content">Underline</span>
                                </button>
                                <button class="toolbar-btn tooltip">
                                    <i class="fas fa-strikethrough"></i>
                                    <span class="tooltip-content">Strikethrough</span>
                                </button>
                            </div>
                            
                            <div class="toolbar-group">
                                <button class="toolbar-btn tooltip">
                                    <i class="fas fa-code"></i>
                                    <span class="tooltip-content">Code</span>
                                </button>
                                <button class="toolbar-btn tooltip">
                                    <i class="fas fa-quote-right"></i>
                                    <span class="tooltip-content">Quote</span>
                                </button>
                                <button class="toolbar-btn tooltip">
                                    <i class="fas fa-link"></i>
                                    <span class="tooltip-content">Link</span>
                                </button>
                                <button class="toolbar-btn tooltip">
                                    <i class="fas fa-image"></i>
                                    <span class="tooltip-content">Image</span>
                                </button>
                            </div>
                            
                            <div class="toolbar-group">
                                <button class="toolbar-btn tooltip">
                                    <i class="fas fa-list-ul"></i>
                                    <span class="tooltip-content">Bullet List</span>
                                </button>
                                <button class="toolbar-btn tooltip">
                                    <i class="fas fa-list-ol"></i>
                                    <span class="tooltip-content">Numbered List</span>
                                </button>
                                <button class="toolbar-btn tooltip">
                                    <i class="fas fa-tasks"></i>
                                    <span class="tooltip-content">Task List</span>
                                </button>
                            </div>
                            
                            <div class="toolbar-group">
                                <button class="toolbar-btn active tooltip">
                                    <i class="fas fa-eye"></i>
                                    <span class="tooltip-content">Preview</span>
                                </button>
                                <button class="toolbar-btn tooltip">
                                    <i class="fas fa-columns"></i>
                                    <span class="tooltip-content">Split View</span>
                                </button>
                            </div>
                            
                            <div style="flex: 1;"></div>
                            
                            <div class="toolbar-group">
                                <button class="toolbar-btn tooltip">
                                    <i class="fas fa-play"></i>
                                    <span class="tooltip-content">Run Prompt</span>
                                </button>
                                <button class="toolbar-btn tooltip">
                                    <i class="fas fa-save"></i>
                                    <span class="tooltip-content">Save</span>
                                </button>
                                <button class="toolbar-btn tooltip">
                                    <i class="fas fa-share"></i>
                                    <span class="tooltip-content">Share</span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Monaco Editor -->
                        <div class="monaco-wrapper">
                            <div id="monaco-editor"></div>
                        </div>
                        
                        <!-- Editor Footer -->
                        <div class="editor-footer">
                            <div class="footer-left">
                                <div class="footer-item">
                                    <i class="fas fa-file-alt footer-icon"></i>
                                    <span>Markdown</span>
                                </div>
                                <div class="footer-item">
                                    <i class="fas fa-code-branch footer-icon"></i>
                                    <span>main</span>
                                </div>
                                <div class="footer-item">
                                    <i class="fas fa-check-circle footer-icon" style="color: var(--success);"></i>
                                    <span>Saved</span>
                                </div>
                            </div>
                            <div class="footer-right">
                                <div class="footer-item">
                                    <span>Ln 42, Col 15</span>
                                </div>
                                <div class="footer-item">
                                    <span>UTF-8</span>
                                </div>
                                <div class="footer-item">
                                    <span>2.3 KB</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right Panel -->
                    <div class="right-panel" id="rightPanel">
                        <div class="panel-header">
                            <h3 class="panel-title">AI Assistant</h3>
                            <button class="panel-close" id="panelClose">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <div class="panel-tabs">
                            <button class="panel-tab active">Assistant</button>
                            <button class="panel-tab">Parameters</button>
                            <button class="panel-tab">History</button>
                            <button class="panel-tab">Versions</button>
                        </div>
                        
                        <div class="panel-content">
                            <!-- AI Assistant Content -->
                            <div id="assistantContent">
                                <div class="form-group">
                                    <label class="form-label">Model Selection</label>
                                    <select class="form-input form-select">
                                        <option>GPT-4 Turbo</option>
                                        <option>GPT-4</option>
                                        <option>GPT-3.5 Turbo</option>
                                        <option>Claude 3 Opus</option>
                                        <option>Claude 3 Sonnet</option>
                                        <option>Gemini Pro 1.5</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Temperature</label>
                                    <input type="range" min="0" max="2" step="0.1" value="0.7" class="form-input">
                                    <div class="form-helper">Controls randomness: 0.7 recommended</div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Max Tokens</label>
                                    <input type="number" class="form-input" value="2048">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">System Prompt</label>
                                    <textarea class="form-input form-textarea" placeholder="Enter system prompt..."></textarea>
                                </div>
                                
                                <button class="btn btn-primary" style="width: 100%;">
                                    <i class="fas fa-magic"></i>
                                    <span>Generate Response</span>
                                </button>
                                
                                <div style="margin-top: var(--space-xl);">
                                    <h4 style="font-size: var(--text-sm); font-weight: 600; margin-bottom: var(--space-md);">Suggestions</h4>
                                    <div style="display: flex; flex-direction: column; gap: var(--space-sm);">
                                        <button class="btn btn-secondary" style="width: 100%; justify-content: flex-start;">
                                            <i class="fas fa-lightbulb"></i>
                                            <span>Improve clarity</span>
                                        </button>
                                        <button class="btn btn-secondary" style="width: 100%; justify-content: flex-start;">
                                            <i class="fas fa-compress-alt"></i>
                                            <span>Make concise</span>
                                        </button>
                                        <button class="btn btn-secondary" style="width: 100%; justify-content: flex-start;">
                                            <i class="fas fa-expand-alt"></i>
                                            <span>Add details</span>
                                        </button>
                                        <button class="btn btn-secondary" style="width: 100%; justify-content: flex-start;">
                                            <i class="fas fa-spell-check"></i>
                                            <span>Fix grammar</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>
    
    <!-- Modal Template -->
    <div class="modal-backdrop" id="modalBackdrop"></div>
    <div class="modal" id="newPromptModal" style="width: 600px;">
        <div class="modal-header">
            <h2 class="modal-title">Create New Prompt</h2>
            <button class="modal-close" onclick="closeModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label class="form-label form-label-required">Prompt Name</label>
                <input type="text" id="newPromptName" class="form-input" placeholder="Enter prompt name...">
            </div>
            
            <div class="form-group">
                <label class="form-label">Description</label>
                <textarea id="newPromptDescription" class="form-input form-textarea" placeholder="Describe your prompt..."></textarea>
            </div>
            
            <div class="form-group">
                <label class="form-label">Category</label>
                <select id="newPromptCategory" class="form-input form-select">
                    <option>General</option>
                    <option>Code Generation</option>
                    <option>Creative Writing</option>
                    <option>Data Analysis</option>
                    <option>Translation</option>
                    <option>Custom</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">Tags</label>
                <input type="text" id="newPromptTags" class="form-input" placeholder="Enter tags separated by commas...">
            </div>
            
            <div class="form-group">
                <label class="form-label">Template</label>
                <select id="newPromptTemplate" class="form-input form-select">
                    <option>Blank</option>
                    <option>Basic Prompt</option>
                    <option>System + User</option>
                    <option>Chain of Thought</option>
                    <option>Few-Shot Learning</option>
                </select>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
            <button class="btn btn-primary" onclick="uiRenderer.createPromptFromModal()">
                <i class="fas fa-plus"></i>
                <span>Create Prompt</span>
            </button>
        </div>
    </div>
    
    <!-- JavaScript -->
    <script>
        // ============================================
        // INITIALIZATION
        // ============================================
        let monacoEditor = null;
        let currentTheme = localStorage.getItem('theme') || 'light';
        let sidebarCollapsed = false;
        let rightPanelCollapsed = false;
        
        // Set initial theme
        document.documentElement.setAttribute('data-theme', currentTheme);
        updateThemeToggle();
        
        // Initialize Monaco Editor
        if (typeof require !== 'undefined') {
            require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs' }});
            require(['vs/editor/editor.main'], function() {
                const initialContent = `# Advanced Prompt Engineering Template

## System Context
You are an expert AI assistant specialized in [DOMAIN]. Your responses should be:
- **Accurate**: Based on verified information
- **Comprehensive**: Cover all relevant aspects
- **Clear**: Easy to understand
- **Actionable**: Provide practical steps

## Task Description
[Describe the specific task or goal here]

## Input Format
\`\`\`
[Define the expected input structure]
\`\`\`

## Processing Steps
1. **Analysis Phase**
   - Parse input data
   - Identify key components
   - Validate requirements

2. **Generation Phase**
   - Apply domain knowledge
   - Structure response
   - Include examples

3. **Validation Phase**
   - Check accuracy
   - Ensure completeness
   - Verify formatting

## Output Format
\`\`\`json
{
  "status": "success",
  "result": {
    // Structured output here
  },
  "metadata": {
    "confidence": 0.95,
    "sources": []
  }
}
\`\`\`

## Examples

### Example 1: Basic Usage
**Input:**
\`\`\`
[Sample input]
\`\`\`

**Output:**
\`\`\`
[Expected output]
\`\`\`

## Constraints & Guidelines
- Maximum response length: 2000 tokens
- Language: English
- Tone: Professional yet friendly
- Include citations when applicable

## Error Handling
If unable to process:
1. Clearly state the issue
2. Suggest alternatives
3. Request clarification

---
*Template Version: 2.0 | Last Updated: ${new Date().toLocaleDateString()}*`;
                
                monacoEditor = monaco.editor.create(document.getElementById('monaco-editor'), {
                    value: initialContent,
                    language: 'markdown',
                    theme: currentTheme === 'dark' ? 'vs-dark' : 'vs',
                    automaticLayout: true,
                    fontSize: 14,
                    fontFamily: "'JetBrains Mono', 'Cascadia Code', monospace",
                    minimap: {
                        enabled: true
                    },
                    scrollBeyondLastLine: false,
                    wordWrap: 'on',
                    lineNumbers: 'on',
                    renderWhitespace: 'selection',
                    bracketPairColorization: {
                        enabled: true
                    },
                    suggest: {
                        showWords: true,
                        showSnippets: true
                    },
                    padding: {
                        top: 16,
                        bottom: 16
                    }
                });
                
                // Add custom keybindings
                monacoEditor.addCommand(monaco.KeyMod.CtrlCmd | monaco.KeyCode.KeyS, function() {
                    savePrompt();
                });
                
                monacoEditor.addCommand(monaco.KeyMod.CtrlCmd | monaco.KeyCode.Enter, function() {
                    runPrompt();
                });
            });
        }
        
        // Initialize Lucide icons
        if (typeof lucide !== 'undefined') {
            lucide.createIcons();
        }
        
        // Initialize keyboard shortcuts
        if (typeof hotkeys !== 'undefined') {
            initializeKeyboardShortcuts();
        }
        
        // ============================================
        // THEME MANAGEMENT
        // ============================================
        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', currentTheme);
            localStorage.setItem('theme', currentTheme);
            updateThemeToggle();
            
            // Update Monaco Editor theme
            if (monacoEditor && typeof monaco !== 'undefined') {
                monaco.editor.setTheme(currentTheme === 'dark' ? 'vs-dark' : 'vs');
            }
            
            showToast('Theme changed', `Switched to ${currentTheme} mode`, 'info');
        }
        
        function updateThemeToggle() {
            const slider = document.querySelector('.theme-toggle-slider');
            if (currentTheme === 'dark') {
                slider.innerHTML = '<i class="fas fa-moon" style="font-size: 10px;"></i>';
            } else {
                slider.innerHTML = '<i class="fas fa-sun" style="font-size: 10px;"></i>';
            }
        }
        
        // ============================================
        // SIDEBAR MANAGEMENT
        // ============================================
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const toggleBtn = document.getElementById('sidebarToggle');
            const toggleIcon = toggleBtn.querySelector('i');
            
            sidebarCollapsed = !sidebarCollapsed;
            
            if (sidebarCollapsed) {
                sidebar.classList.add('collapsed');
                toggleIcon.className = 'fas fa-chevron-right';
            } else {
                sidebar.classList.remove('collapsed');
                toggleIcon.className = 'fas fa-chevron-left';
            }
        }
        
        // ============================================
        // PANEL MANAGEMENT
        // ============================================
        function toggleRightPanel() {
            const panel = document.getElementById('rightPanel');
            rightPanelCollapsed = !rightPanelCollapsed;
            
            if (rightPanelCollapsed) {
                panel.classList.add('collapsed');
            } else {
                panel.classList.remove('collapsed');
            }
        }
        
        // ============================================
        // MODAL MANAGEMENT
        // ============================================
        function openModal() {
            const backdrop = document.getElementById('modalBackdrop');
            const modal = document.getElementById('newPromptModal');
            
            backdrop.classList.add('active');
            modal.classList.add('active');
            
            // Focus first input
            setTimeout(() => {
                modal.querySelector('.form-input').focus();
            }, 100);
        }
        
        function closeModal() {
            const backdrop = document.getElementById('modalBackdrop');
            const modal = document.getElementById('newPromptModal');
            
            backdrop.classList.remove('active');
            modal.classList.remove('active');
        }
        
        function createNewPrompt() {
            // This function is now handled by uiRenderer.createPromptFromModal()
            // We keep it to avoid breaking the old onclick, but delegate to the new system
            if (typeof uiRenderer !== 'undefined') {
                uiRenderer.createPromptFromModal();
            } else {
                showToast('Success', 'New prompt created successfully', 'success');
                closeModal();
            }
        }
        
        // ============================================
        // TOAST NOTIFICATIONS
        // ============================================
        function showToast(title, message, type = 'info') {
            const container = document.getElementById('toastContainer');
            if (!container) return;
            const toast = document.createElement('div');
            toast.className = `toast toast-${type} animate-slideInRight`;
            
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            };
            
            toast.innerHTML = `
                <i class="fas ${icons[type]} toast-icon"></i>
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <i class="fas fa-times toast-close"></i>
            `;
            
            container.appendChild(toast);
            
            // Auto dismiss after 5 seconds
            const dismissTimer = setTimeout(() => {
                toast.style.animation = 'slideInRight var(--transition-base) ease-out reverse';
                setTimeout(() => {
                    if (container.contains(toast)) {
                       container.removeChild(toast);
                    }
                }, 250);
            }, 5000);
            
            // Manual dismiss
            toast.querySelector('.toast-close').addEventListener('click', () => {
                clearTimeout(dismissTimer);
                if (container.contains(toast)) {
                    container.removeChild(toast);
                }
            });
        }
        
        // ============================================
        // PROMPT OPERATIONS
        // ============================================
        function savePrompt() {
            // Simulate save operation
            showToast('Saved', 'Prompt saved successfully', 'success');
            
            // Update footer status
            const saveIndicator = document.querySelector('.footer-item i.fa-check-circle');
            if (saveIndicator) {
                saveIndicator.style.color = 'var(--success)';
            }
        }
        
        function runPrompt() {
            showToast('Running', 'Executing prompt with selected model...', 'info');
            
            // Simulate API call
            setTimeout(() => {
                showToast('Complete', 'Response generated successfully', 'success');
            }, 2000);
        }
        
        // ============================================
        // KEYBOARD SHORTCUTS
        // ============================================
        function initializeKeyboardShortcuts() {
            if (typeof hotkeys === 'undefined') return;
            // Command/Ctrl + K for search
            hotkeys('cmd+k, ctrl+k', function(event, handler) {
                event.preventDefault();
                document.querySelector('.search-input').focus();
            });
            
            // Command/Ctrl + N for new prompt
            hotkeys('cmd+n, ctrl+n', function(event, handler) {
                event.preventDefault();
                openModal();
            });
            
            // Command/Ctrl + S for save
            hotkeys('cmd+s, ctrl+s', function(event, handler) {
                event.preventDefault();
                savePrompt();
            });
            
            // Command/Ctrl + Enter to run
            hotkeys('cmd+enter, ctrl+enter', function(event, handler) {
                event.preventDefault();
                runPrompt();
            });
            
            // Command/Ctrl + B to toggle sidebar
            hotkeys('cmd+b, ctrl+b', function(event, handler) {
                event.preventDefault();
                toggleSidebar();
            });
            
            // Command/Ctrl + / to toggle right panel
            hotkeys('cmd+/, ctrl+/', function(event, handler) {
                event.preventDefault();
                toggleRightPanel();
            });
            
            // Escape to close modal
            hotkeys('escape', function(event, handler) {
                event.preventDefault();
                closeModal();
            });
        }
        
        // ============================================
        // TAB MANAGEMENT
        // ============================================
        function switchTab(tabElement) {
            // Remove active from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Add active to clicked tab
            tabElement.classList.add('active');
            
            // Load content for the tab
            const tabName = tabElement.querySelector('span').textContent;
            showToast('Tab Switched', `Loaded ${tabName}`, 'info');
        }
        
        function closeTab(event, tabElement) {
            event.stopPropagation();
            
            const tabBar = tabElement.parentElement;
            const wasActive = tabElement.classList.contains('active');
            
            // Remove the tab
            tabBar.removeChild(tabElement);
            
            // If it was active, activate the first remaining tab
            if (wasActive) {
                const firstTab = tabBar.querySelector('.tab');
                if (firstTab) {
                    firstTab.classList.add('active');
                }
            }
            
            showToast('Tab Closed', 'Tab closed successfully', 'info');
        }
        
        function addNewTab() {
            const tabBar = document.querySelector('.tab-bar');
            const newTab = document.createElement('button');
            newTab.className = 'tab';
            newTab.innerHTML = `
                <i class="fas fa-file-alt tab-icon"></i>
                <span>untitled.md</span>
                <i class="fas fa-times tab-close"></i>
            `;
            
            // Insert before the add button
            const addButton = document.querySelector('.tab-add');
            tabBar.insertBefore(newTab, addButton);
            
            // Add event listeners
            newTab.addEventListener('click', () => switchTab(newTab));
            newTab.querySelector('.tab-close').addEventListener('click', (e) => closeTab(e, newTab));
            
            // Switch to the new tab
            switchTab(newTab);
        }
        
        // ============================================
        // NAV TAB MANAGEMENT
        // ============================================
        function switchNavTab(tabName) {
            // Update nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.tab === tabName) {
                    tab.classList.add('active');
                }
            });
            
            // Load content based on tab
            loadTabContent(tabName);
        }
        
        function loadTabContent(tabName) {
            const workspaceTitle = document.querySelector('.workspace-title span');
            const icons = {
                workspace: 'fa-laptop-code',
                library: 'fa-book',
                analytics: 'fa-chart-line',
                models: 'fa-robot',
                team: 'fa-users'
            };
            
            const titles = {
                workspace: 'Workspace',
                library: 'Prompt Library',
                analytics: 'Analytics Dashboard',
                models: 'Model Configuration',
                team: 'Team Collaboration'
            };
            
            // Update title
            workspaceTitle.textContent = titles[tabName];
            const icon = document.querySelector('.workspace-title-icon');
            icon.className = `fas ${icons[tabName]} workspace-title-icon`;
            
            showToast('Navigation', `Switched to ${titles[tabName]}`, 'info');
        }
        
        // ============================================
        // SEARCH FUNCTIONALITY
        // ============================================
        function performSearch(query) {
            if (query.trim() === '') return;
            
            showToast('Searching', `Searching for "${query}"...`, 'info');
            
            // Simulate search delay
            setTimeout(() => {
                showToast('Search Complete', `Found 12 results for "${query}"`, 'success');
            }, 500);
        }
        
        // ============================================
        // EVENT LISTENERS
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            // Theme toggle
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
            
            // Sidebar toggle
            document.getElementById('sidebarToggle').addEventListener('click', toggleSidebar);
            
            // Panel close
            document.getElementById('panelClose').addEventListener('click', toggleRightPanel);
            
            // New prompt button
            document.getElementById('newPromptBtn').addEventListener('click', openModal);
            
            // Modal backdrop close
            document.getElementById('modalBackdrop').addEventListener('click', closeModal);
            
            // Search input
            document.querySelector('.search-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    performSearch(this.value);
                }
            });
            
            // Nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', () => switchNavTab(tab.dataset.tab));
            });
            
            // Editor tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => switchTab(tab));
                const closeBtn = tab.querySelector('.tab-close');
                if (closeBtn) {
                    closeBtn.addEventListener('click', (e) => closeTab(e, tab));
                }
            });
            
            // Add new tab
            document.querySelector('.tab-add').addEventListener('click', addNewTab);
            
            // Panel tabs
            document.querySelectorAll('.panel-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.panel-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            // Toolbar buttons
            document.querySelectorAll('.toolbar-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // Toggle active state for certain buttons
                    if (this.querySelector('.fa-eye, .fa-columns')) {
                        this.classList.toggle('active');
                    }
                });
            });
            
            // Sidebar items
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            // Window controls (decorative)
            document.querySelector('.window-control.close').addEventListener('click', () => {
                showToast('Window Control', 'Close action not available in browser', 'warning');
            });
            
            document.querySelector('.window-control.minimize').addEventListener('click', () => {
                showToast('Window Control', 'Minimize action not available in browser', 'warning');
            });
            
            document.querySelector('.window-control.maximize').addEventListener('click', () => {
                if (document.fullscreenElement) {
                    document.exitFullscreen();
                } else {
                    document.documentElement.requestFullscreen().catch(err => {
                        showToast('Error', `Could not enter fullscreen mode: ${err.message}`, 'error');
                    });
                }
            });
            
            // Auto-save timer
            setInterval(() => {
                if (monacoEditor && monacoEditor.getValue()) {
                    // Auto-save logic here
                    const saveIndicator = document.querySelector('.footer-item span');
                    if (saveIndicator && saveIndicator.textContent === 'Saved') {
                        // Content hasn't changed, no need to save
                    }
                }
            }, 30000); // Auto-save every 30 seconds
            
            // Welcome message
            setTimeout(() => {
                showToast('Welcome!', 'LLM Prompt Studio Pro is ready', 'success');
            }, 1000);
        });
        
        // ============================================
        // WINDOW RESIZE HANDLING
        // ============================================
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                if (monacoEditor) {
                    monacoEditor.layout();
                }
            }, 250);
        });
        
        // ============================================
        // PREVENT ACCIDENTAL NAVIGATION
        // ============================================
        window.addEventListener('beforeunload', function(e) {
            if (monacoEditor && monacoEditor.getValue()) {
                // This part is often blocked by modern browsers, but it's good practice
                // e.preventDefault();
                // e.returnValue = '';
            }
        });
        
        // ============================================
        // ADVANCED PROMPT MANAGEMENT SYSTEM
        // ============================================
        class PromptManager {
            constructor() {
                this.prompts = this.loadPrompts();
                this.currentPrompt = null;
                this.history = [];
                this.templates = this.loadTemplates();
                this.favorites = this.loadFavorites();
                this.tags = new Set();
                this.initializeTemplates();
            }
            
            getPrompts() {
                return this.prompts;
            }

            getPromptById(id) {
                return this.prompts.find(p => p.id === id);
            }

            initializeTemplates() {
                this.defaultTemplates = {
                    'basic': {
                        name: 'Basic Prompt',
                        content: `# Prompt Title\n\n## Description\n[Describe your prompt here]\n\n## Input\n[Input format]\n\n## Output\n[Expected output]`,
                        icon: 'fa-file-alt',
                        color: '#3b82f6'
                    },
                    'cot': {
                        name: 'Chain of Thought',
                        content: `# Chain of Thought Prompt\n\n## Problem Statement\n[Define the problem]\n\n## Step-by-Step Reasoning\n1. First, let's understand...\n2. Next, we need to...\n3. Then, we should...\n4. Finally, we can...\n\n## Conclusion\n[Final answer]`,
                        icon: 'fa-link',
                        color: '#10b981'
                    },
                    'few-shot': {
                        name: 'Few-Shot Learning',
                        content: `# Few-Shot Learning Template\n\n## Task Description\n[Describe the task]\n\n## Examples\n\n### Example 1\n**Input:** [input]\n**Output:** [output]\n\n### Example 2\n**Input:** [input]\n**Output:** [output]\n\n### Example 3\n**Input:** [input]\n**Output:** [output]\n\n## New Input\n[Your input here]`,
                        icon: 'fa-graduation-cap',
                        color: '#f59e0b'
                    },
                    'role-play': {
                        name: 'Role Playing',
                        content: `# Role-Playing Prompt\n\n## Character/Role\nYou are a [role/character] with the following attributes:\n- Expertise: [areas of expertise]\n- Personality: [personality traits]\n- Background: [relevant background]\n\n## Scenario\n[Describe the scenario]\n\n## Task\n[What the AI should do in this role]\n\n## Constraints\n- Stay in character\n- Use appropriate tone and language\n- Consider the context`,
                        icon: 'fa-theater-masks',
                        color: '#ec4899'
                    },
                    'code-gen': {
                        name: 'Code Generation',
                        content: `# Code Generation Prompt\n\n## Language\n[Programming language]\n\n## Requirements\n- [ ] Requirement 1\n- [ ] Requirement 2\n- [ ] Requirement 3\n\n## Input/Output\n\`\`\`\nInput: [describe input]\nOutput: [describe output]\n\`\`\`\n\n## Constraints\n- Performance: [requirements]\n- Style: [coding style]\n- Libraries: [allowed libraries]\n\n## Example Usage\n\`\`\`[language]\n// Example code\n\`\`\``,
                        icon: 'fa-code',
                        color: '#8b5cf6'
                    },
                    'analysis': {
                        name: 'Data Analysis',
                        content: `# Data Analysis Prompt\n\n## Dataset Description\n[Describe the data]\n\n## Analysis Goals\n1. [Goal 1]\n2. [Goal 2]\n3. [Goal 3]\n\n## Methodology\n- Data cleaning\n- Statistical analysis\n- Visualization\n- Interpretation\n\n## Expected Insights\n[What insights are you looking for?]\n\n## Output Format\n- Summary statistics\n- Key findings\n- Recommendations`,
                        icon: 'fa-chart-bar',
                        color: '#06b6d4'
                    },
                    'creative': {
                        name: 'Creative Writing',
                        content: `# Creative Writing Prompt\n\n## Genre\n[Genre/Style]\n\n## Setting\n- Time: [when]\n- Place: [where]\n- Atmosphere: [mood/tone]\n\n## Characters\n- Protagonist: [description]\n- Antagonist: [description]\n- Supporting: [description]\n\n## Plot Elements\n- Hook: [opening]\n- Conflict: [main conflict]\n- Resolution: [how it ends]\n\n## Style Guidelines\n- Tone: [formal/informal/etc]\n- POV: [first/third person]\n- Length: [word count]`,
                        icon: 'fa-pen-fancy',
                        color: '#f97316'
                    },
                    'translation': {
                        name: 'Translation',
                        content: `# Translation Prompt\n\n## Source Language\n[Language]\n\n## Target Language\n[Language]\n\n## Context\n- Domain: [technical/literary/casual]\n- Audience: [who will read this]\n- Purpose: [why this translation]\n\n## Special Instructions\n- Tone preservation\n- Cultural adaptation\n- Technical terminology\n\n## Text to Translate\n[Insert text here]\n\n## Glossary\n- Term 1: [translation]\n- Term 2: [translation]`,
                        icon: 'fa-language',
                        color: '#0ea5e9'
                    }
                };
            }
            
            loadPrompts() {
                try {
                    const saved = localStorage.getItem('prompts');
                    return saved ? JSON.parse(saved) : [];
                } catch (e) {
                    console.error("Failed to load prompts from localStorage", e);
                    return [];
                }
            }
            
            savePrompts() {
                localStorage.setItem('prompts', JSON.stringify(this.prompts));
            }
            
            loadTemplates() {
                try {
                    const saved = localStorage.getItem('templates');
                    return saved ? JSON.parse(saved) : [];
                } catch (e) {
                    console.error("Failed to load templates from localStorage", e);
                    return [];
                }
            }
            
            saveTemplates() {
                localStorage.setItem('templates', JSON.stringify(this.templates));
            }
            
            loadFavorites() {
                try {
                    const saved = localStorage.getItem('favorites');
                    return saved ? JSON.parse(saved) : [];
                } catch (e) {
                    console.error("Failed to load favorites from localStorage", e);
                    return [];
                }
            }
            
            saveFavorites() {
                localStorage.setItem('favorites', JSON.stringify(this.favorites));
            }
            
            createPrompt(data) {
                const prompt = {
                    id: this.generateId(),
                    name: data.name,
                    content: data.content || '',
                    description: data.description || '',
                    category: data.category || 'General',
                    tags: data.tags || [],
                    model: data.model || 'gpt-4',
                    parameters: data.parameters || {
                        temperature: 0.7,
                        maxTokens: 2048,
                        topP: 1,
                        frequencyPenalty: 0,
                        presencePenalty: 0
                    },
                    created: new Date().toISOString(),
                    modified: new Date().toISOString(),
                    version: 1,
                    versions: [],
                    metrics: {
                        uses: 0,
                        tokens: 0,
                        avgResponseTime: 0,
                        successRate: 100
                    }
                };
                
                this.prompts.push(prompt);
                this.savePrompts();
                this.addToHistory('created', prompt);
                
                // Update tags
                prompt.tags.forEach(tag => this.tags.add(tag));
                
                return prompt;
            }
            
            updatePrompt(id, updates) {
                const index = this.prompts.findIndex(p => p.id === id);
                if (index !== -1) {
                    const oldPrompt = { ...this.prompts[index] };
                    
                    // Save version
                    oldPrompt.versions.push({
                        version: oldPrompt.version,
                        content: oldPrompt.content,
                        modified: oldPrompt.modified
                    });
                    
                    // Update prompt
                    this.prompts[index] = {
                        ...this.prompts[index],
                        ...updates,
                        modified: new Date().toISOString(),
                        version: oldPrompt.version + 1
                    };
                    
                    this.savePrompts();
                    this.addToHistory('updated', this.prompts[index]);
                    
                    return this.prompts[index];
                }
                return null;
            }
            
            deletePrompt(id) {
                const index = this.prompts.findIndex(p => p.id === id);
                if (index !== -1) {
                    const deleted = this.prompts.splice(index, 1)[0];
                    this.savePrompts();
                    this.addToHistory('deleted', deleted);
                    return true;
                }
                return false;
            }
            
            duplicatePrompt(id) {
                const prompt = this.prompts.find(p => p.id === id);
                if (prompt) {
                    const duplicate = {
                        ...prompt,
                        id: this.generateId(),
                        name: prompt.name + ' (Copy)',
                        created: new Date().toISOString(),
                        modified: new Date().toISOString(),
                        version: 1,
                        versions: [],
                        metrics: {
                            uses: 0,
                            tokens: 0,
                            avgResponseTime: 0,
                            successRate: 100
                        }
                    };
                    
                    this.prompts.push(duplicate);
                    this.savePrompts();
                    this.addToHistory('duplicated', duplicate);
                    
                    return duplicate;
                }
                return null;
            }
            
            searchPrompts(query) {
                const lowerQuery = query.toLowerCase();
                return this.prompts.filter(prompt => 
                    prompt.name.toLowerCase().includes(lowerQuery) ||
                    prompt.description.toLowerCase().includes(lowerQuery) ||
                    prompt.content.toLowerCase().includes(lowerQuery) ||
                    prompt.tags.some(tag => tag.toLowerCase().includes(lowerQuery))
                );
            }
            
            filterByCategory(category) {
                return this.prompts.filter(prompt => prompt.category === category);
            }
            
            filterByTags(tags) {
                return this.prompts.filter(prompt => 
                    tags.every(tag => prompt.tags.includes(tag))
                );
            }
            
            addToFavorites(id) {
                if (!this.favorites.includes(id)) {
                    this.favorites.push(id);
                    this.saveFavorites();
                    return true;
                }
                return false;
            }
            
            removeFromFavorites(id) {
                const index = this.favorites.indexOf(id);
                if (index !== -1) {
                    this.favorites.splice(index, 1);
                    this.saveFavorites();
                    return true;
                }
                return false;
            }
            
            getFavorites() {
                return this.prompts.filter(prompt => 
                    this.favorites.includes(prompt.id)
                );
            }
            
            exportPrompt(id, format = 'json') {
                const prompt = this.prompts.find(p => p.id === id);
                if (!prompt) return null;
                
                switch (format) {
                    case 'json':
                        return JSON.stringify(prompt, null, 2);
                    case 'markdown':
                        return this.promptToMarkdown(prompt);
                    case 'txt':
                        return this.promptToText(prompt);
                    default:
                        return null;
                }
            }
            
            importPrompt(data, format = 'json') {
                try {
                    let prompt;
                    switch (format) {
                        case 'json':
                            prompt = JSON.parse(data);
                            break;
                        case 'markdown':
                            prompt = this.markdownToPrompt(data);
                            break;
                        default:
                            return null;
                    }
                    
                    prompt.id = this.generateId();
                    prompt.created = new Date().toISOString();
                    prompt.modified = new Date().toISOString();
                    
                    this.prompts.push(prompt);
                    this.savePrompts();
                    
                    return prompt;
                } catch (error) {
                    console.error('Import failed:', error);
                    return null;
                }
            }
            
            promptToMarkdown(prompt) {
                return `# ${prompt.name}

## Description
${prompt.description}

## Category
${prompt.category}

## Tags
${prompt.tags.join(', ')}

## Model
${prompt.model}

## Parameters
- Temperature: ${prompt.parameters.temperature}
- Max Tokens: ${prompt.parameters.maxTokens}
- Top P: ${prompt.parameters.topP}
- Frequency Penalty: ${prompt.parameters.frequencyPenalty}
- Presence Penalty: ${prompt.parameters.presencePenalty}

## Content
${prompt.content}

## Metrics
- Uses: ${prompt.metrics.uses}
- Total Tokens: ${prompt.metrics.tokens}
- Avg Response Time: ${prompt.metrics.avgResponseTime}ms
- Success Rate: ${prompt.metrics.successRate}%

---
*Created: ${new Date(prompt.created).toLocaleString()}*
*Modified: ${new Date(prompt.modified).toLocaleString()}*
*Version: ${prompt.version}*`;
            }
            
            promptToText(prompt) {
                return `${prompt.name}
${'='.repeat(prompt.name.length)}

${prompt.description}

Category: ${prompt.category}
Tags: ${prompt.tags.join(', ')}
Model: ${prompt.model}

Content:
${prompt.content}`;
            }
            
            markdownToPrompt(markdown) {
                // Simple markdown parser
                const lines = markdown.split('\n');
                const prompt = {
                    name: '',
                    description: '',
                    category: 'General',
                    tags: [],
                    model: 'gpt-4',
                    content: '',
                    parameters: {
                        temperature: 0.7,
                        maxTokens: 2048,
                        topP: 1,
                        frequencyPenalty: 0,
                        presencePenalty: 0
                    }
                };
                
                let currentSection = '';
                for (const line of lines) {
                    if (line.startsWith('# ')) {
                        prompt.name = line.substring(2);
                    } else if (line.startsWith('## ')) {
                        currentSection = line.substring(3).toLowerCase();
                    } else if (currentSection === 'description') {
                        prompt.description += line + '\n';
                    } else if (currentSection === 'content') {
                        prompt.content += line + '\n';
                    } else if (line.includes('Category:')) {
                        prompt.category = line.split(':')[1].trim();
                    } else if (line.includes('Tags:')) {
                        prompt.tags = line.split(':')[1].split(',').map(t => t.trim());
                    } else if (line.includes('Model:')) {
                        prompt.model = line.split(':')[1].trim();
                    }
                }
                
                return prompt;
            }
            
            generateId() {
                return 'prompt_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            }
            
            addToHistory(action, prompt) {
                this.history.unshift({
                    action,
                    prompt: { ...prompt },
                    timestamp: new Date().toISOString()
                });
                
                // Keep only last 100 history items
                if (this.history.length > 100) {
                    this.history = this.history.slice(0, 100);
                }
                
                localStorage.setItem('promptHistory', JSON.stringify(this.history));
            }
            
            getHistory() {
                return this.history;
            }
            
            getStatistics() {
                const stats = {
                    total: this.prompts.length,
                    byCategory: {},
                    byModel: {},
                    totalTokens: 0,
                    totalUses: 0,
                    avgTokens: 0,
                    avgUses: 0,
                    mostUsed: null,
                    recentlyModified: [],
                    tags: Array.from(this.tags)
                };
                
                this.prompts.forEach(prompt => {
                    // By category
                    stats.byCategory[prompt.category] = (stats.byCategory[prompt.category] || 0) + 1;
                    
                    // By model
                    stats.byModel[prompt.model] = (stats.byModel[prompt.model] || 0) + 1;
                    
                    // Tokens and uses
                    stats.totalTokens += prompt.metrics.tokens;
                    stats.totalUses += prompt.metrics.uses;
                    
                    // Most used
                    if (!stats.mostUsed || prompt.metrics.uses > stats.mostUsed.metrics.uses) {
                        stats.mostUsed = prompt;
                    }
                });
                
                // Averages
                if (this.prompts.length > 0) {
                    stats.avgTokens = Math.round(stats.totalTokens / this.prompts.length);
                    stats.avgUses = Math.round(stats.totalUses / this.prompts.length);
                }
                
                // Recently modified (last 5)
                stats.recentlyModified = [...this.prompts]
                    .sort((a, b) => new Date(b.modified) - new Date(a.modified))
                    .slice(0, 5);
                
                return stats;
            }
        }
        
        // ============================================
        // AI MODEL CONFIGURATION SYSTEM
        // ============================================
        class ModelManager {
            constructor() {
                this.models = this.initializeModels();
                this.activeModel = 'gpt-4-turbo';
                this.customModels = this.loadCustomModels();
                this.apiKeys = this.loadAPIKeys();
                this.usage = this.loadUsage();
            }
            
            initializeModels() {
                return {
                    'gpt-4-turbo': {
                        name: 'GPT-4 Turbo',
                        provider: 'OpenAI',
                        version: '1106-preview',
                        contextWindow: 128000,
                        outputTokens: 4096,
                        trainingData: 'April 2023',
                        capabilities: ['text', 'code', 'analysis', 'creative'],
                        pricing: { input: 0.01, output: 0.03 },
                        icon: 'fa-brain',
                        color: '#10b981',
                        description: 'Most capable GPT-4 model with improved instruction following'
                    },
                    'gpt-4': {
                        name: 'GPT-4',
                        provider: 'OpenAI',
                        version: '0613',
                        contextWindow: 8192,
                        outputTokens: 4096,
                        trainingData: 'September 2021',
                        capabilities: ['text', 'code', 'analysis', 'creative'],
                        pricing: { input: 0.03, output: 0.06 },
                        icon: 'fa-brain',
                        color: '#10b981',
                        description: 'Original GPT-4 model with strong reasoning capabilities'
                    },
                    'gpt-3.5-turbo': {
                        name: 'GPT-3.5 Turbo',
                        provider: 'OpenAI',
                        version: '1106',
                        contextWindow: 16384,
                        outputTokens: 4096,
                        trainingData: 'September 2021',
                        capabilities: ['text', 'code', 'analysis'],
                        pricing: { input: 0.001, output: 0.002 },
                        icon: 'fa-bolt',
                        color: '#3b82f6',
                        description: 'Fast and efficient model for most tasks'
                    },
                    'claude-3-opus': {
                        name: 'Claude 3 Opus',
                        provider: 'Anthropic',
                        version: '20240229',
                        contextWindow: 200000,
                        outputTokens: 4096,
                        trainingData: 'August 2023',
                        capabilities: ['text', 'code', 'analysis', 'creative', 'vision'],
                        pricing: { input: 0.015, output: 0.075 },
                        icon: 'fa-robot',
                        color: '#8b5cf6',
                        description: 'Most powerful Claude model with superior reasoning'
                    },
                    'claude-3-sonnet': {
                        name: 'Claude 3 Sonnet',
                        provider: 'Anthropic',
                        version: '20240229',
                        contextWindow: 200000,
                        outputTokens: 4096,
                        trainingData: 'August 2023',
                        capabilities: ['text', 'code', 'analysis', 'vision'],
                        pricing: { input: 0.003, output: 0.015 },
                        icon: 'fa-robot',
                        color: '#a78bfa',
                        description: 'Balanced performance and cost'
                    },
                    'claude-3-haiku': {
                        name: 'Claude 3 Haiku',
                        provider: 'Anthropic',
                        version: '20240307',
                        contextWindow: 200000,
                        outputTokens: 4096,
                        trainingData: 'August 2023',
                        capabilities: ['text', 'code'],
                        pricing: { input: 0.00025, output: 0.00125 },
                        icon: 'fa-feather',
                        color: '#c084fc',
                        description: 'Fastest Claude model for simple tasks'
                    },
                    'gemini-pro': {
                        name: 'Gemini Pro 1.5',
                        provider: 'Google',
                        version: '001',
                        contextWindow: 1000000,
                        outputTokens: 8192,
                        trainingData: 'November 2023',
                        capabilities: ['text', 'code', 'analysis', 'vision', 'audio'],
                        pricing: { input: 0.00125, output: 0.005 },
                        icon: 'fa-gem',
                        color: '#ea580c',
                        description: 'Multimodal model with massive context window'
                    },
                    'gemini-ultra': {
                        name: 'Gemini Ultra',
                        provider: 'Google',
                        version: '001',
                        contextWindow: 1000000,
                        outputTokens: 8192,
                        trainingData: 'November 2023',
                        capabilities: ['text', 'code', 'analysis', 'creative', 'vision', 'audio'],
                        pricing: { input: 0.007, output: 0.021 },
                        icon: 'fa-crown',
                        color: '#dc2626',
                        description: 'Most capable Gemini model'
                    },
                    'mistral-large': {
                        name: 'Mistral Large',
                        provider: 'Mistral AI',
                        version: '2402',
                        contextWindow: 32000,
                        outputTokens: 4096,
                        trainingData: 'Unknown',
                        capabilities: ['text', 'code', 'analysis'],
                        pricing: { input: 0.008, output: 0.024 },
                        icon: 'fa-wind',
                        color: '#0ea5e9',
                        description: 'Top-tier reasoning and multilingual capabilities'
                    },
                    'mixtral-8x7b': {
                        name: 'Mixtral 8x7B',
                        provider: 'Mistral AI',
                        version: '0.1',
                        contextWindow: 32000,
                        outputTokens: 4096,
                        trainingData: 'Unknown',
                        capabilities: ['text', 'code'],
                        pricing: { input: 0.0007, output: 0.0007 },
                        icon: 'fa-layer-group',
                        color: '#06b6d4',
                        description: 'Mixture of experts model with great performance'
                    }
                };
            }
            
            loadCustomModels() {
                const saved = localStorage.getItem('customModels');
                return saved ? JSON.parse(saved) : {};
            }
            
            saveCustomModels() {
                localStorage.setItem('customModels', JSON.stringify(this.customModels));
            }
            
            loadAPIKeys() {
                const saved = localStorage.getItem('apiKeys');
                return saved ? JSON.parse(saved) : {};
            }
            
            saveAPIKeys() {
                // Encrypt before saving (in production, use proper encryption)
                const encrypted = btoa(JSON.stringify(this.apiKeys));
                localStorage.setItem('apiKeys', encrypted);
            }
            
            loadUsage() {
                const saved = localStorage.getItem('modelUsage');
                return saved ? JSON.parse(saved) : {};
            }
            
            saveUsage() {
                localStorage.setItem('modelUsage', JSON.stringify(this.usage));
            }
            
            setAPIKey(provider, key) {
                this.apiKeys[provider] = key;
                this.saveAPIKeys();
            }
            
            getAPIKey(provider) {
                return this.apiKeys[provider] || null;
            }
            
            addCustomModel(model) {
                const id = 'custom_' + Date.now();
                this.customModels[id] = {
                    ...model,
                    id,
                    provider: 'Custom',
                    icon: 'fa-cog',
                    color: '#64748b'
                };
                this.saveCustomModels();
                return id;
            }
            
            getAllModels() {
                return { ...this.models, ...this.customModels };
            }
            
            getModel(id) {
                return this.models[id] || this.customModels[id] || null;
            }
            
            setActiveModel(id) {
                if (this.getModel(id)) {
                    this.activeModel = id;
                    return true;
                }
                return false;
            }
            
            trackUsage(modelId, tokens, cost) {
                if (!this.usage[modelId]) {
                    this.usage[modelId] = {
                        requests: 0,
                        tokens: 0,
                        cost: 0,
                        lastUsed: null
                    };
                }
                
                this.usage[modelId].requests++;
                this.usage[modelId].tokens += tokens;
                this.usage[modelId].cost += cost;
                this.usage[modelId].lastUsed = new Date().toISOString();
                
                this.saveUsage();
            }
            
            getUsageStats() {
                const stats = {
                    total: {
                        requests: 0,
                        tokens: 0,
                        cost: 0
                    },
                    byModel: {},
                    byProvider: {},
                    topModels: []
                };
                
                Object.entries(this.usage).forEach(([modelId, usage]) => {
                    const model = this.getModel(modelId);
                    if (model) {
                        // Total stats
                        stats.total.requests += usage.requests;
                        stats.total.tokens += usage.tokens;
                        stats.total.cost += usage.cost;
                        
                        // By model
                        stats.byModel[modelId] = usage;
                        
                        // By provider
                        if (!stats.byProvider[model.provider]) {
                            stats.byProvider[model.provider] = {
                                requests: 0,
                                tokens: 0,
                                cost: 0
                            };
                        }
                        stats.byProvider[model.provider].requests += usage.requests;
                        stats.byProvider[model.provider].tokens += usage.tokens;
                        stats.byProvider[model.provider].cost += usage.cost;
                    }
                });
                
                // Top models by requests
                stats.topModels = Object.entries(stats.byModel)
                    .sort((a, b) => b[1].requests - a[1].requests)
                    .slice(0, 5)
                    .map(([id, usage]) => ({
                        model: this.getModel(id),
                        usage
                    }));
                
                return stats;
            }
            
            estimateCost(modelId, inputTokens, outputTokens) {
                const model = this.getModel(modelId);
                if (!model || !model.pricing) return 0;
                
                const inputCost = (inputTokens / 1000) * model.pricing.input;
                const outputCost = (outputTokens / 1000) * model.pricing.output;
                
                return inputCost + outputCost;
            }
            
            compareModels(modelIds) {
                return modelIds.map(id => {
                    const model = this.getModel(id);
                    const usage = this.usage[id] || { requests: 0, tokens: 0, cost: 0 };
                    
                    return {
                        ...model,
                        usage,
                        score: this.calculateModelScore(model, usage)
                    };
                }).sort((a, b) => b.score - a.score);
            }
            
            calculateModelScore(model, usage) {
                // Simple scoring algorithm
                let score = 0;
                
                // Context window (normalized to 0-100)
                score += (model.contextWindow / 10000) * 20;
                
                // Capabilities
                score += model.capabilities.length * 10;
                
                // Usage (if frequently used, it's probably good)
                score += Math.min(usage.requests / 10, 30);
                
                // Cost efficiency (inverse of price)
                const avgPrice = (model.pricing.input + model.pricing.output) / 2;
                score += (1 / avgPrice) * 10;
                
                return Math.min(score, 100);
            }
        }
        
        // ============================================
        // ANALYTICS & METRICS SYSTEM
        // ============================================
        class AnalyticsManager {
            constructor() {
                this.metrics = this.loadMetrics();
                this.sessions = this.loadSessions();
                this.currentSession = this.startSession();
                this.charts = {};
            }
            
            loadMetrics() {
                const saved = localStorage.getItem('analytics');
                return saved ? JSON.parse(saved) : {
                    prompts: {
                        created: 0,
                        edited: 0,
                        deleted: 0,
                        executed: 0
                    },
                    tokens: {
                        input: 0,
                        output: 0,
                        total: 0
                    },
                    costs: {
                        daily: [],
                        weekly: [],
                        monthly: [],
                        total: 0
                    },
                    performance: {
                        avgResponseTime: 0,
                        successRate: 100,
                        errorRate: 0
                    },
                    usage: {
                        daily: [],
                        hourly: new Array(24).fill(0),
                        byCategory: {},
                        byModel: {}
                    }
                };
            }
            
            saveMetrics() {
                localStorage.setItem('analytics', JSON.stringify(this.metrics));
            }
            
            loadSessions() {
                const saved = localStorage.getItem('sessions');
                return saved ? JSON.parse(saved) : [];
            }
            
            saveSessions() {
                localStorage.setItem('sessions', JSON.stringify(this.sessions));
            }
            
            startSession() {
                const session = {
                    id: 'session_' + Date.now(),
                    start: new Date().toISOString(),
                    end: null,
                    duration: 0,
                    actions: [],
                    prompts: 0,
                    tokens: 0
                };
                
                this.sessions.push(session);
                this.saveSessions();
                
                return session;
            }
            
            endSession() {
                if (this.currentSession) {
                    this.currentSession.end = new Date().toISOString();
                    this.currentSession.duration = 
                        new Date(this.currentSession.end) - new Date(this.currentSession.start);
                    this.saveSessions();
                }
            }
            
            trackAction(action, data = {}) {
                const event = {
                    action,
                    data,
                    timestamp: new Date().toISOString()
                };
                
                // Add to current session
                if (this.currentSession) {
                    this.currentSession.actions.push(event);
                }
                
                // Update metrics based on action
                switch (action) {
                    case 'prompt_created':
                        this.metrics.prompts.created++;
                        break;
                    case 'prompt_edited':
                        this.metrics.prompts.edited++;
                        break;
                    case 'prompt_deleted':
                        this.metrics.prompts.deleted++;
                        break;
                    case 'prompt_executed':
                        this.metrics.prompts.executed++;
                        this.trackTokenUsage(data.inputTokens, data.outputTokens);
                        this.trackCost(data.cost);
                        break;
                    case 'error':
                        this.metrics.performance.errorRate++;
                        break;
                }
                
                // Track hourly usage
                const hour = new Date().getHours();
                this.metrics.usage.hourly[hour]++;
                
                this.saveMetrics();
            }
            
            trackTokenUsage(input, output) {
                this.metrics.tokens.input += input || 0;
                this.metrics.tokens.output += output || 0;
                this.metrics.tokens.total = this.metrics.tokens.input + this.metrics.tokens.output;
                
                if (this.currentSession) {
                    this.currentSession.tokens += (input || 0) + (output || 0);
                }
            }
            
            trackCost(cost) {
                this.metrics.costs.total += cost || 0;
                
                // Track daily cost
                const today = new Date().toISOString().split('T')[0];
                const dailyEntry = this.metrics.costs.daily.find(d => d.date === today);
                
                if (dailyEntry) {
                    dailyEntry.cost += cost || 0;
                } else {
                    this.metrics.costs.daily.push({ date: today, cost: cost || 0 });
                }
                
                // Keep only last 30 days
                if (this.metrics.costs.daily.length > 30) {
                    this.metrics.costs.daily = this.metrics.costs.daily.slice(-30);
                }
            }
            
            trackPerformance(responseTime, success) {
                const currentAvg = this.metrics.performance.avgResponseTime;
                const totalRequests = this.metrics.prompts.executed;
                
                // Update average response time
                this.metrics.performance.avgResponseTime = 
                    (currentAvg * (totalRequests - 1) + responseTime) / totalRequests;
                
                // Update success rate
                if (success) {
                    this.metrics.performance.successRate = 
                        ((this.metrics.performance.successRate * (totalRequests - 1) + 100) / totalRequests);
                } else {
                    this.metrics.performance.successRate = 
                        ((this.metrics.performance.successRate * (totalRequests - 1)) / totalRequests);
                    this.metrics.performance.errorRate++;
                }
                
                this.saveMetrics();
            }
            
            getMetricsSummary() {
                return {
                    overview: {
                        totalPrompts: this.metrics.prompts.created,
                        totalExecutions: this.metrics.prompts.executed,
                        totalTokens: this.metrics.tokens.total,
                        totalCost: this.metrics.costs.total.toFixed(2),
                        avgResponseTime: this.metrics.performance.avgResponseTime.toFixed(0) + 'ms',
                        successRate: this.metrics.performance.successRate.toFixed(1) + '%'
                    },
                    trends: {
                        daily: this.calculateDailyTrends(),
                        weekly: this.calculateWeeklyTrends(),
                        monthly: this.calculateMonthlyTrends()
                    },
                    insights: this.generateInsights()
                };
            }
            
            calculateDailyTrends() {
                const last7Days = this.metrics.costs.daily.slice(-7);
                const total = last7Days.reduce((sum, day) => sum + day.cost, 0);
                const avg = total / 7;
                
                return {
                    data: last7Days,
                    total,
                    average: avg,
                    trend: this.calculateTrend(last7Days.map(d => d.cost))
                };
            }
            
            calculateWeeklyTrends() {
                // Group daily data into weeks
                const weeks = [];
                const dailyData = [...this.metrics.costs.daily];
                
                while (dailyData.length > 0) {
                    const week = dailyData.splice(0, 7);
                    const weekTotal = week.reduce((sum, day) => sum + day.cost, 0);
                    weeks.push({
                        start: week[0]?.date,
                        end: week[week.length - 1]?.date,
                        cost: weekTotal
                    });
                }
                
                return {
                    data: weeks.slice(-4),
                    trend: this.calculateTrend(weeks.map(w => w.cost))
                };
            }
            
            calculateMonthlyTrends() {
                // Group daily data into months
                const months = {};
                
                this.metrics.costs.daily.forEach(day => {
                    const month = day.date.substring(0, 7);
                    months[month] = (months[month] || 0) + day.cost;
                });
                
                const monthlyData = Object.entries(months).map(([month, cost]) => ({
                    month,
                    cost
                }));
                
                return {
                    data: monthlyData.slice(-12),
                    trend: this.calculateTrend(monthlyData.map(m => m.cost))
                };
            }
            
            calculateTrend(values) {
                if (values.length < 2) return 'stable';
                
                const firstHalf = values.slice(0, Math.floor(values.length / 2));
                const secondHalf = values.slice(Math.floor(values.length / 2));
                
                const firstAvg = firstHalf.reduce((a, b) => a + b, 0) / firstHalf.length;
                const secondAvg = secondHalf.reduce((a, b) => a + b, 0) / secondHalf.length;
                
                const change = ((secondAvg - firstAvg) / firstAvg) * 100;
                
                if (change > 10) return 'increasing';
                if (change < -10) return 'decreasing';
                return 'stable';
            }
            
            generateInsights() {
                const insights = [];
                
                // Token usage insight
                if (this.metrics.tokens.total > 100000) {
                    insights.push({
                        type: 'info',
                        title: 'High Token Usage',
                        message: `You've used ${(this.metrics.tokens.total / 1000).toFixed(0)}k tokens. Consider optimizing your prompts.`
                    });
                }
                
                // Cost trend insight
                const dailyTrend = this.calculateDailyTrends();
                if (dailyTrend.trend === 'increasing') {
                    insights.push({
                        type: 'warning',
                        title: 'Increasing Costs',
                        message: 'Your daily costs are trending upward. Review your usage patterns.'
                    });
                }
                
                // Success rate insight
                if (this.metrics.performance.successRate < 90) {
                    insights.push({
                        type: 'error',
                        title: 'Low Success Rate',
                        message: `Success rate is ${this.metrics.performance.successRate.toFixed(1)}%. Check your prompts for errors.`
                    });
                }
                
                // Peak usage times
                const peakHour = this.metrics.usage.hourly.indexOf(Math.max(...this.metrics.usage.hourly));
                insights.push({
                    type: 'success',
                    title: 'Peak Usage Time',
                    message: `Your most active hour is ${peakHour}:00. Schedule intensive tasks accordingly.`
                });
                
                return insights;
            }
            
            renderCharts() {
                // Render Token Usage Chart
                this.renderTokenChart();
                
                // Render Cost Trend Chart
                this.renderCostChart();
                
                // Render Model Usage Chart
                this.renderModelChart();
                
                // Render Hourly Activity Chart
                this.renderActivityChart();
            }
            
            renderTokenChart() {
                const ctx = document.getElementById('tokenChart');
                if (!ctx) return;
                
                if (this.charts.token) {
                    this.charts.token.destroy();
                }
                
                this.charts.token = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Input Tokens', 'Output Tokens'],
                        datasets: [{
                            data: [this.metrics.tokens.input, this.metrics.tokens.output],
                            backgroundColor: ['#3b82f6', '#10b981'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
            
            renderCostChart() {
                const ctx = document.getElementById('costChart');
                if (!ctx) return;
                
                if (this.charts.cost) {
                    this.charts.cost.destroy();
                }
                
                const last7Days = this.metrics.costs.daily.slice(-7);
                
                this.charts.cost = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: last7Days.map(d => d.date),
                        datasets: [{
                            label: 'Daily Cost ($)',
                            data: last7Days.map(d => d.cost),
                            borderColor: '#8b5cf6',
                            backgroundColor: 'rgba(139, 92, 246, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return '$' + value.toFixed(2);
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            renderModelChart() {
                const ctx = document.getElementById('modelChart');
                if (!ctx) return;
                
                if (this.charts.model) {
                    this.charts.model.destroy();
                }
                
                // Get model usage data
                const modelData = Object.entries(this.metrics.usage.byModel || {})
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 5);
                
                this.charts.model = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: modelData.map(([name]) => name),
                        datasets: [{
                            label: 'Uses',
                            data: modelData.map(([, uses]) => uses),
                            backgroundColor: '#f59e0b'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
            
            renderActivityChart() {
                const ctx = document.getElementById('activityChart');
                if (!ctx) return;
                
                if (this.charts.activity) {
                    this.charts.activity.destroy();
                }
                
                const hours = Array.from({length: 24}, (_, i) => i + ':00');
                
                this.charts.activity = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: hours,
                        datasets: [{
                            label: 'Activity',
                            data: this.metrics.usage.hourly,
                            backgroundColor: '#06b6d4'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
        }
        
        // ============================================
        // COLLABORATION & TEAM FEATURES
        // ============================================
        class CollaborationManager {
            constructor() {
                this.team = this.loadTeam();
                this.sharedPrompts = this.loadSharedPrompts();
                this.comments = this.loadComments();
                this.permissions = this.loadPermissions();
            }
            
            loadTeam() {
                const saved = localStorage.getItem('team');
                return saved ? JSON.parse(saved) : [
                    {
                        id: 'user_1',
                        name: 'You',
                        email: 'user@example.com',
                        role: 'owner',
                        avatar: '👤',
                        status: 'online',
                        lastActive: new Date().toISOString()
                    }
                ];
            }
            
            saveTeam() {
                localStorage.setItem('team', JSON.stringify(this.team));
            }
            
            loadSharedPrompts() {
                const saved = localStorage.getItem('sharedPrompts');
                return saved ? JSON.parse(saved) : [];
            }
            
            saveSharedPrompts() {
                localStorage.setItem('sharedPrompts', JSON.stringify(this.sharedPrompts));
            }
            
            loadComments() {
                const saved = localStorage.getItem('comments');
                return saved ? JSON.parse(saved) : {};
            }
            
            saveComments() {
                localStorage.setItem('comments', JSON.stringify(this.comments));
            }
            
            loadPermissions() {
                const saved = localStorage.getItem('permissions');
                return saved ? JSON.parse(saved) : {};
            }
            
            savePermissions() {
                localStorage.setItem('permissions', JSON.stringify(this.permissions));
            }
            
            sharePrompt(promptId, userIds, permissions = 'view') {
                const share = {
                    id: 'share_' + Date.now(),
                    promptId,
                    sharedBy: 'user_1',
                    sharedWith: userIds,
                    permissions,
                    sharedAt: new Date().toISOString()
                };
                
                this.sharedPrompts.push(share);
                this.saveSharedPrompts();
                
                // Set permissions
                userIds.forEach(userId => {
                    if (!this.permissions[userId]) {
                        this.permissions[userId] = {};
                    }
                    this.permissions[userId][promptId] = permissions;
                });
                this.savePermissions();
                
                return share;
            }
            
            addComment(promptId, comment) {
                if (!this.comments[promptId]) {
                    this.comments[promptId] = [];
                }
                
                const newComment = {
                    id: 'comment_' + Date.now(),
                    userId: 'user_1',
                    text: comment,
                    timestamp: new Date().toISOString(),
                    edited: false
                };
                
                this.comments[promptId].push(newComment);
                this.saveComments();
                
                return newComment;
            }
            
            getComments(promptId) {
                return this.comments[promptId] || [];
            }
            
            addTeamMember(member) {
                const newMember = {
                    id: 'user_' + Date.now(),
                    ...member,
                    status: 'offline',
                    lastActive: new Date().toISOString()
                };
                
                this.team.push(newMember);
                this.saveTeam();
                
                return newMember;
            }
            
            removeTeamMember(userId) {
                const index = this.team.findIndex(m => m.id === userId);
                if (index !== -1) {
                    this.team.splice(index, 1);
                    this.saveTeam();
                    
                    // Remove permissions
                    delete this.permissions[userId];
                    this.savePermissions();
                    
                    return true;
                }
                return false;
            }
            
            updateMemberRole(userId, role) {
                const member = this.team.find(m => m.id === userId);
                if (member) {
                    member.role = role;
                    this.saveTeam();
                    return true;
                }
                return false;
            }
            
            getSharedWithMe() {
                // In a real app, this would fetch prompts shared with the current user
                return this.sharedPrompts.filter(share => 
                    share.sharedWith.includes('user_1')
                );
            }
            
            getMyShares() {
                return this.sharedPrompts.filter(share => 
                    share.sharedBy === 'user_1'
                );
            }
        }
        
        // ============================================
        // EXPORT & IMPORT SYSTEM
        // ============================================
        class ExportImportManager {
            constructor() {
                this.formats = ['json', 'markdown', 'txt', 'csv', 'yaml'];
            }
            
            exportData(data, format = 'json', filename = 'export') {
                let content;
                let mimeType;
                
                switch (format) {
                    case 'json':
                        content = JSON.stringify(data, null, 2);
                        mimeType = 'application/json';
                        break;
                    case 'markdown':
                        content = this.toMarkdown(data);
                        mimeType = 'text/markdown';
                        break;
                    case 'txt':
                        content = this.toText(data);
                        mimeType = 'text/plain';
                        break;
                    case 'csv':
                        content = this.toCSV(data);
                        mimeType = 'text/csv';
                        break;
                    case 'yaml':
                        content = this.toYAML(data);
                        mimeType = 'text/yaml';
                        break;
                    default:
                        content = JSON.stringify(data, null, 2);
                        mimeType = 'application/json';
                }
                
                this.downloadFile(content, `${filename}.${format}`, mimeType);
            }
            
            importData(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    
                    reader.onload = (e) => {
                        try {
                            const content = e.target.result;
                            const extension = file.name.split('.').pop().toLowerCase();
                            
                            let data;
                            switch (extension) {
                                case 'json':
                                    data = JSON.parse(content);
                                    break;
                                case 'csv':
                                    data = this.parseCSV(content);
                                    break;
                                case 'yaml':
                                case 'yml':
                                    data = this.parseYAML(content);
                                    break;
                                default:
                                    data = { raw: content };
                            }
                            
                            resolve(data);
                        } catch (error) {
                            reject(error);
                        }
                    };
                    
                    reader.onerror = reject;
                    reader.readAsText(file);
                });
            }
            
            downloadFile(content, filename, mimeType) {
                const blob = new Blob([content], { type: mimeType });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
            
            toMarkdown(data) {
                if (Array.isArray(data)) {
                    return data.map(item => this.itemToMarkdown(item)).join('\n\n---\n\n');
                }
                return this.itemToMarkdown(data);
            }
            
            itemToMarkdown(item) {
                let md = '';
                
                if (item.name) md += `# ${item.name}\n\n`;
                if (item.description) md += `${item.description}\n\n`;
                if (item.content) md += `## Content\n${item.content}\n\n`;
                if (item.tags) md += `**Tags:** ${item.tags.join(', ')}\n\n`;
                if (item.category) md += `**Category:** ${item.category}\n\n`;
                if (item.model) md += `**Model:** ${item.model}\n\n`;
                
                return md;
            }
            
            toText(data) {
                if (Array.isArray(data)) {
                    return data.map(item => this.itemToText(item)).join('\n\n' + '='.repeat(50) + '\n\n');
                }
                return this.itemToText(data);
            }
            
            itemToText(item) {
                let text = '';
                
                Object.entries(item).forEach(([key, value]) => {
                    if (value !== null && value !== undefined) {
                        if (typeof value === 'object') {
                            text += `${key}:\n${JSON.stringify(value, null, 2)}\n\n`;
                        } else {
                            text += `${key}: ${value}\n`;
                        }
                    }
                });
                
                return text;
            }
            
            toCSV(data) {
                if (!Array.isArray(data) || data.length === 0) {
                    return '';
                }
                
                // Get all unique keys
                const keys = new Set();
                data.forEach(item => {
                    Object.keys(item).forEach(key => keys.add(key));
                });
                
                const headers = Array.from(keys);
                const rows = data.map(item => 
                    headers.map(header => {
                        const value = item[header];
                        if (typeof value === 'object') {
                            return JSON.stringify(value);
                        }
                        return value || '';
                    })
                );
                
                // Create CSV
                const csvContent = [
                    headers.join(','),
                    ...rows.map(row => row.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(','))
                ].join('\n');
                
                return csvContent;
            }
            
            toYAML(data) {
                // Simple YAML converter (for production, use a proper library)
                return this.objectToYAML(data, 0);
            }
            
            objectToYAML(obj, indent) {
                let yaml = '';
                const spaces = '  '.repeat(indent);
                
                if (Array.isArray(obj)) {
                    obj.forEach(item => {
                        yaml += `${spaces}- `;
                        if (typeof item === 'object') {
                            yaml += '\n' + this.objectToYAML(item, indent + 1);
                        } else {
                            yaml += `${item}\n`;
                        }
                    });
                } else if (typeof obj === 'object' && obj !== null) {
                    Object.entries(obj).forEach(([key, value]) => {
                        yaml += `${spaces}${key}: `;
                        if (typeof value === 'object') {
                            yaml += '\n' + this.objectToYAML(value, indent + 1);
                        } else {
                            yaml += `${value}\n`;
                        }
                    });
                }
                
                return yaml;
            }
            
            parseCSV(content) {
                const lines = content.split('\n');
                const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
                const data = [];
                
                for (let i = 1; i < lines.length; i++) {
                    if (lines[i].trim()) {
                        const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
                        const item = {};
                        
                        headers.forEach((header, index) => {
                            const value = values[index];
                            try {
                                item[header] = JSON.parse(value);
                            } catch {
                                item[header] = value;
                            }
                        });
                        
                        data.push(item);
                    }
                }
                
                return data;
            }
            
            parseYAML(content) {
                // Simple YAML parser (for production, use a proper library)
                // This is a very basic implementation
                const lines = content.split('\n');
                const result = {};
                let currentKey = null;
                
                lines.forEach(line => {
                    const trimmed = line.trim();
                    if (trimmed && !trimmed.startsWith('#')) {
                        const colonIndex = trimmed.indexOf(':');
                        if (colonIndex !== -1) {
                            const key = trimmed.substring(0, colonIndex).trim();
                            const value = trimmed.substring(colonIndex + 1).trim();
                            
                            if (value) {
                                result[key] = value;
                            } else {
                                currentKey = key;
                                result[key] = {};
                            }
                        }
                    }
                });
                
                return result;
            }
            
            backup() {
                const data = {
                    version: '1.0',
                    timestamp: new Date().toISOString(),
                    prompts: promptManager.prompts,
                    templates: promptManager.templates,
                    favorites: promptManager.favorites,
                    models: modelManager.customModels,
                    analytics: analyticsManager.metrics,
                    team: collaborationManager.team,
                    settings: {
                        theme: currentTheme,
                        // Add other settings
                    }
                };
                
                const filename = `llm-studio-backup-${new Date().toISOString().split('T')[0]}`;
                this.exportData(data, 'json', filename);
            }
            
            restore(file) {
                return this.importData(file).then(data => {
                    if (data.version && data.prompts) {
                        // Restore prompts
                        promptManager.prompts = data.prompts;
                        promptManager.savePrompts();
                        
                        // Restore templates
                        if (data.templates) {
                            promptManager.templates = data.templates;
                            promptManager.saveTemplates();
                        }
                        
                        // Restore favorites
                        if (data.favorites) {
                            promptManager.favorites = data.favorites;
                            promptManager.saveFavorites();
                        }
                        
                        // Restore custom models
                        if (data.models) {
                            modelManager.customModels = data.models;
                            modelManager.saveCustomModels();
                        }
                        
                        // Restore analytics
                        if (data.analytics) {
                            analyticsManager.metrics = data.analytics;
                            analyticsManager.saveMetrics();
                        }
                        
                        // Restore team
                        if (data.team) {
                            collaborationManager.team = data.team;
                            collaborationManager.saveTeam();
                        }
                        
                        // Restore settings
                        if (data.settings) {
                            if (data.settings.theme) {
                                currentTheme = data.settings.theme;
                                document.documentElement.setAttribute('data-theme', currentTheme);
                                localStorage.setItem('theme', currentTheme);
                                updateThemeToggle();
                            }
                        }
                        
                        return true;
                    }
                    throw new Error('Invalid backup file');
                });
            }
        }
        
        // ============================================
        // INITIALIZE MANAGERS
        // ============================================
        const promptManager = new PromptManager();
        const modelManager = new ModelManager();
        const analyticsManager = new AnalyticsManager();
        const collaborationManager = new CollaborationManager();
        const exportImportManager = new ExportImportManager();
        
        // Track page unload
        window.addEventListener('beforeunload', () => {
            analyticsManager.endSession();
        });
        
        // Auto-save every 5 minutes
        setInterval(() => {
            promptManager.savePrompts();
            modelManager.saveCustomModels();
            analyticsManager.saveMetrics();
            showToast('Auto-Save', 'All data saved automatically', 'success');
        }, 300000);
        
        // ============================================
        // UI RENDERING ENGINE
        // ============================================
        class UIRenderer {
            constructor() {
                this.promptListContainer = null;
                this.searchResults = [];
                this.currentFilter = 'all';
                this.sortBy = 'created';
                this.init();
            }

            init() {
                // Wait for DOM
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', () => this.setupUI());
                } else {
                    this.setupUI();
                }
            }

            setupUI() {
                // Create dynamic prompt list container
                this.createPromptListUI();
                // Setup real-time search
                this.setupRealtimeSearch();
                // Initial render
                this.renderPrompts();
            }

            createPromptListUI() {
                // Find or create prompt list container
                const sidebar = document.querySelector('.sidebar-menu');
                if (sidebar) {
                    // Create dynamic prompts section
                    const promptsSection = document.createElement('div');
                    promptsSection.className = 'sidebar-section dynamic-prompts';
                    promptsSection.innerHTML = `
                        <div class="sidebar-section-title" style="display: flex; justify-content: space-between; align-items: center;">
                            <span>My Prompts</span>
                            <button class="btn-micro" onclick="uiRenderer.showCreatePromptModal()">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div class="prompts-filter-bar">
                            <select class="filter-select" onchange="uiRenderer.filterPrompts(this.value)">
                                <option value="all">All Prompts</option>
                                <option value="favorites">Favorites</option>
                                <option value="recent">Recent</option>
                                <option value="Code Generation">Code</option>
                                <option value="Creative Writing">Writing</option>
                                <option value="Data Analysis">Data</option>
                            </select>
                        </div>
                        <div id="promptList" class="prompt-list"></div>
                    `;
                    
                    // Insert after first section
                    const firstSection = sidebar.querySelector('.sidebar-section');
                    if (firstSection) {
                        firstSection.after(promptsSection);
                    } else {
                        sidebar.appendChild(promptsSection);
                    }
                    
                    this.promptListContainer = document.getElementById('promptList');
                }
            }

            renderPrompts(prompts = null) {
                if (!this.promptListContainer) return;
                
                const promptsToRender = prompts || promptManager.getPrompts();
                
                if (promptsToRender.length === 0) {
                    this.promptListContainer.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-file-alt" style="font-size: 2rem; opacity: 0.3;"></i>
                            <p style="margin-top: 0.5rem; opacity: 0.5;">No prompts yet</p>
                            <button class="btn btn-sm btn-primary" style="padding: 4px 8px; font-size: 12px;" onclick="uiRenderer.showCreatePromptModal()">
                                Create First Prompt
                            </button>
                        </div>
                    `;
                    return;
                }

                // Sort prompts
                const sorted = this.sortPrompts(promptsToRender);
                
                // Render prompt items with animations
                this.promptListContainer.innerHTML = sorted.map((prompt, index) => `
                    <div class="sidebar-item prompt-item animate-fadeIn" 
                         data-id="${prompt.id}"
                         style="animation-delay: ${index * 0.05}s"
                         onclick="uiRenderer.selectPrompt('${prompt.id}')">
                        <i class="fas ${this.getCategoryIcon(prompt.category)} sidebar-item-icon"></i>
                        <div class="prompt-item-content">
                            <span class="sidebar-item-text">${this.escapeHtml(prompt.name)}</span>
                            <span class="prompt-item-meta">${prompt.category || 'General'}</span>
                        </div>
                        <div class="prompt-item-actions">
                            ${prompt.isFavorite ? '<i class="fas fa-star" style="color: var(--warning);"></i>' : ''}
                            <button class="btn-micro" onclick="event.stopPropagation(); uiRenderer.promptActions('${prompt.id}')">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
            }

            sortPrompts(prompts) {
                switch(this.sortBy) {
                    case 'name':
                        return prompts.sort((a, b) => a.name.localeCompare(b.name));
                    case 'category':
                        return prompts.sort((a, b) => (a.category || '').localeCompare(b.category || ''));
                    case 'modified':
                        return prompts.sort((a, b) => new Date(b.modified) - new Date(a.modified));
                    case 'created':
                    default:
                        return prompts.sort((a, b) => new Date(b.created) - new Date(a.created));
                }
            }

            getCategoryIcon(category) {
                const icons = {
                    'Code Generation': 'fa-code',
                    'Creative Writing': 'fa-pen',
                    'Data Analysis': 'fa-chart-bar',
                    'Translation': 'fa-language',
                    'Education': 'fa-graduation-cap',
                    'Creative': 'fa-palette',
                    'Business': 'fa-briefcase',
                    'Research': 'fa-microscope'
                };
                return icons[category] || 'fa-file-alt';
            }

            selectPrompt(promptId) {
                const prompt = promptManager.getPromptById(promptId);
                if (prompt) {
                    this.displayPromptInEditor(prompt);
                    // Update active state
                    document.querySelectorAll('.prompt-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    const selectedItem = document.querySelector(`.prompt-item[data-id="${promptId}"]`);
                    if (selectedItem) {
                        selectedItem.classList.add('active');
                    }
                }
            }

            displayPromptInEditor(prompt) {
                // Update editor with prompt content
                if (monacoEditor && typeof monacoEditor.setValue === 'function') {
                    monacoEditor.setValue(prompt.content);
                }
                
                // Update prompt details panel
                this.updatePromptDetails(prompt);
                
                // Show right panel if hidden
                const rightPanel = document.getElementById('rightPanel');
                if (rightPanel && rightPanel.classList.contains('collapsed')) {
                    toggleRightPanel();
                }
            }

            updatePromptDetails(prompt) {
                const detailsContainer = document.querySelector('#rightPanel .panel-content');
                if (detailsContainer) {
                    const panelTitle = document.querySelector('#rightPanel .panel-title');
                    if (panelTitle) panelTitle.textContent = 'Prompt Details';

                    const panelTabs = document.querySelector('#rightPanel .panel-tabs');
                    if (panelTabs) panelTabs.style.display = 'none';

                    detailsContainer.innerHTML = `
                        <div class="prompt-details-header">
                            <h3 style="font-size: var(--text-lg); font-weight: 600;">${this.escapeHtml(prompt.name)}</h3>
                            <button class="btn btn-ghost btn-sm" onclick="uiRenderer.editPrompt('${prompt.id}')">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                        </div>
                        <div class="prompt-details-meta">
                            <span class="meta-item">
                                <i class="fas fa-folder"></i> ${prompt.category || 'General'}
                            </span>
                            <span class="meta-item">
                                <i class="fas fa-clock"></i> ${this.formatDate(prompt.created)}
                            </span>
                            <span class="meta-item">
                                <i class="fas fa-fire"></i> ${prompt.metrics.uses || 0} uses
                            </span>
                        </div>
                        <div class="prompt-details-tags">
                            ${(prompt.tags || []).map(tag => `
                                <span class="tag">${this.escapeHtml(tag)}</span>
                            `).join('')}
                        </div>
                        <div class="prompt-details-description">
                            ${this.escapeHtml(prompt.description || 'No description')}
                        </div>
                        <div class="prompt-details-actions">
                            <button class="btn btn-primary" onclick="uiRenderer.testPrompt('${prompt.id}')">
                                <i class="fas fa-play"></i> Test Prompt
                            </button>
                            <button class="btn btn-secondary" onclick="uiRenderer.duplicatePrompt('${prompt.id}')">
                                <i class="fas fa-copy"></i> Duplicate
                            </button>
                            <button class="btn btn-ghost" onclick="uiRenderer.exportPrompt('${prompt.id}')">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                    `;
                }
            }

            setupRealtimeSearch() {
                const searchInput = document.querySelector('.search-input');
                if (searchInput) {
                    let searchTimeout;
                    searchInput.addEventListener('input', (e) => {
                        clearTimeout(searchTimeout);
                        searchTimeout = setTimeout(() => {
                            this.performSearch(e.target.value);
                        }, 300);
                    });
                }
            }

            performSearch(query) {
                if (!query) {
                    this.renderPrompts();
                    return;
                }
                
                const results = promptManager.searchPrompts(query);
                this.renderPrompts(results);
                
                showToast('Search Results', `Found ${results.length} prompts matching "${query}"`, 'info');
            }

            filterPrompts(filter) {
                this.currentFilter = filter;
                let filtered = promptManager.getPrompts();
                
                switch(filter) {
                    case 'favorites':
                        filtered = promptManager.getFavorites();
                        break;
                    case 'recent':
                        filtered = [...promptManager.getPrompts()].sort((a, b) => new Date(b.modified) - new Date(a.modified)).slice(0, 10);
                        break;
                    case 'all':
                        // no filter
                        break;
                    default: // Filter by category
                        filtered = filtered.filter(p => p.category === filter);
                        break;
                }
                
                this.renderPrompts(filtered);
            }

            showCreatePromptModal() {
                openModal();
            }

            createPromptFromModal() {
                const name = document.getElementById('newPromptName').value;
                const description = document.getElementById('newPromptDescription').value;
                const category = document.getElementById('newPromptCategory').value;
                const tags = document.getElementById('newPromptTags').value.split(',').map(t => t.trim()).filter(t => t);
                const templateValue = document.getElementById('newPromptTemplate').value;

                if (!name) {
                    showToast('Error', 'Prompt name is required', 'error');
                    return;
                }

                let content = '';
                const templateMap = {
                    'Basic Prompt': 'basic',
                    'Chain of Thought': 'cot',
                    'Few-Shot Learning': 'few-shot'
                };
                const templateKey = templateMap[templateValue];

                if (templateKey && promptManager.defaultTemplates[templateKey]) {
                    content = promptManager.defaultTemplates[templateKey].content;
                } else if (templateValue === 'System + User') {
                    content = '## System\n\n## User\n';
                }

                const newPrompt = promptManager.createPrompt({
                    name,
                    description,
                    category,
                    tags,
                    content
                });

                this.renderPrompts();
                this.selectPrompt(newPrompt.id);
                closeModal();
                showToast('Success', `Prompt "${name}" created successfully!`, 'success');
            }

            escapeHtml(text) {
                if (typeof text !== 'string') return '';
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            formatDate(date) {
                const d = new Date(date);
                const now = new Date();
                const diffMs = now - d;
                const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
                
                if (diffHours < 1) return 'Just now';
                if (diffHours < 24) return `${diffHours}h ago`;
                if (diffHours < 168) return `${Math.floor(diffHours / 24)}d ago`;
                
                return d.toLocaleDateString();
            }

            promptActions(promptId) {
                // Show context menu with actions
                console.log('Actions for prompt:', promptId);
                showToast('Info', 'Actions menu not yet implemented.', 'info');
            }

            editPrompt(promptId) {
                const prompt = promptManager.getPromptById(promptId);
                if (prompt) {
                    showToast('Info', 'Edit functionality not yet implemented.', 'info');
                }
            }

            duplicatePrompt(promptId) {
                const prompt = promptManager.getPromptById(promptId);
                if (prompt) {
                    const newPrompt = promptManager.duplicatePrompt(promptId);
                    this.renderPrompts();
                    showToast('Success', `Prompt duplicated as "${newPrompt.name}"`, 'success');
                }
            }

            exportPrompt(promptId) {
                const prompt = promptManager.getPromptById(promptId);
                if (prompt) {
                    exportImportManager.exportData([prompt], 'json', `prompt-${prompt.name}`);
                }
            }

            testPrompt(promptId) {
                const prompt = promptManager.getPromptById(promptId);
                if (prompt) {
                    // Open test modal or integrate with AI model
                    showToast('Test Mode', 'Opening prompt test environment...', 'info');
                }
            }
        }

        // Initialize UI Renderer
        const uiRenderer = new UIRenderer();

        // Initialize demo data
        function initializeDemoData() {
            if (promptManager.prompts.length === 0) {
                // Add demo prompts
                promptManager.createPrompt({
                    name: 'Code Review Assistant',
                    description: 'Analyzes code for bugs, performance issues, and best practices',
                    category: 'Code Generation',
                    tags: ['code', 'review', 'analysis'],
                    content: `You are an expert code reviewer. Analyze the provided code for:
1. Bugs and potential errors
2. Performance optimizations
3. Security vulnerabilities
4. Code style and best practices
5. Suggestions for improvement

Provide detailed feedback with specific line references.`
                });
                
                promptManager.createPrompt({
                    name: 'Creative Story Generator',
                    description: 'Generates creative stories based on themes and characters',
                    category: 'Creative Writing',
                    tags: ['creative', 'story', 'fiction'],
                    content: `Create an engaging story with the following elements:
- Genre: [specified genre]
- Main character: [character description]
- Setting: [time and place]
- Conflict: [main challenge]

Make the story compelling with vivid descriptions and realistic dialogue.`
                });
                
                promptManager.createPrompt({
                    name: 'Data Analysis Expert',
                    description: 'Analyzes datasets and provides insights',
                    category: 'Data Analysis',
                    tags: ['data', 'analysis', 'statistics'],
                    content: `Analyze the provided dataset and:
1. Identify key patterns and trends
2. Calculate relevant statistics
3. Detect anomalies or outliers
4. Provide actionable insights
5. Suggest visualizations

Present findings in a clear, structured format.`
                });
                uiRenderer.renderPrompts();
            }
        }
        
        document.addEventListener('DOMContentLoaded', initializeDemoData);

        // ============================================
        // ADVANCED FEATURES ENGINE
        // ============================================
        
        // Enhanced Auto-Save System
        class AutoSaveManager {
            constructor() {
                this.isDirty = false;
                this.saveTimeout = null;
                this.saveInterval = 5000; // 5 seconds
                this.indicator = null;
                this.init();
            }

            init() {
                this.createIndicator();
                this.setupListeners();
                this.startAutoSave();
            }

            createIndicator() {
                const indicator = document.createElement('div');
                indicator.className = 'auto-save-indicator';
                indicator.id = 'autoSaveIndicator';
                indicator.innerHTML = `
                    <i class="fas fa-save"></i>
                    <span>Auto-saving...</span>
                `;
                document.body.appendChild(indicator);
                this.indicator = indicator;
            }

            markDirty() {
                this.isDirty = true;
                clearTimeout(this.saveTimeout);
                this.saveTimeout = setTimeout(() => this.save(), this.saveInterval);
            }

            async save() {
                if (!this.isDirty) return;

                this.showIndicator('Saving...');
                
                try {
                    // Save all managers
                    await Promise.all([
                        promptManager.savePrompts(),
                        modelManager.saveCustomModels(),
                        analyticsManager.saveMetrics()
                    ]);
                    
                    this.isDirty = false;
                    this.showIndicator('Saved', 'success');
                    
                    setTimeout(() => this.hideIndicator(), 2000);
                } catch (error) {
                    console.error('Auto-save failed:', error);
                    this.showIndicator('Save failed', 'error');
                }
            }

            showIndicator(text, status = 'saving') {
                if (!this.indicator) return;
                
                this.indicator.className = `auto-save-indicator show ${status}`;
                this.indicator.querySelector('span').textContent = text;
                
                const icon = this.indicator.querySelector('i');
                switch(status) {
                    case 'success':
                        icon.className = 'fas fa-check';
                        break;
                    case 'error':
                        icon.className = 'fas fa-exclamation-triangle';
                        break;
                    default:
                        icon.className = 'fas fa-save';
                }
            }

            hideIndicator() {
                if (this.indicator) {
                    this.indicator.classList.remove('show');
                }
            }

            setupListeners() {
                // Listen for changes
                document.addEventListener('input', (e) => {
                    if (e.target.matches('.form-control, .editor-input')) {
                        this.markDirty();
                    }
                });

                // Listen for prompt changes
                window.addEventListener('promptChanged', () => this.markDirty());
                window.addEventListener('settingsChanged', () => this.markDirty());
            }

            startAutoSave() {
                // Auto-save every 30 seconds if dirty
                setInterval(() => {
                    if (this.isDirty) {
                        this.save();
                    }
                }, 30000);
            }
        }

        // Advanced Keyboard Shortcuts
        class KeyboardManager {
            constructor() {
                this.shortcuts = new Map();
                this.init();
            }

            init() {
                this.registerShortcuts();
                this.setupListener();
            }

            registerShortcuts() {
                // Application shortcuts
                this.register('cmd+k, ctrl+k', () => this.focusSearch());
                this.register('cmd+n, ctrl+n', () => uiRenderer.showCreatePromptModal());
                this.register('cmd+s, ctrl+s', () => autoSaveManager.save());
                this.register('cmd+/, ctrl+/', () => this.toggleCommandPalette());
                this.register('cmd+\\, ctrl+\\', () => toggleSidebar());
                this.register('cmd+b, ctrl+b', () => toggleSidebar());
                this.register('cmd+shift+p, ctrl+shift+p', () => this.toggleRightPanel());
                
                // Navigation shortcuts
                this.register('alt+1', () => this.switchTab('workspace'));
                this.register('alt+2', () => this.switchTab('library'));
                this.register('alt+3', () => this.switchTab('analytics'));
                this.register('alt+4', () => this.switchTab('models'));
                this.register('alt+5', () => this.switchTab('team'));
                
                // Editor shortcuts
                this.register('cmd+enter, ctrl+enter', () => this.runPrompt());
                this.register('cmd+d, ctrl+d', () => this.duplicateCurrentPrompt());
                this.register('cmd+shift+d, ctrl+shift+d', () => this.deleteCurrentPrompt());
                this.register('escape', () => this.closeModals());
            }

            register(keys, callback) {
                keys.split(',').forEach(key => {
                    this.shortcuts.set(key.trim(), callback);
                });
            }

            setupListener() {
                document.addEventListener('keydown', (e) => {
                    const key = this.getKeyString(e);
                    const handler = this.shortcuts.get(key);
                    
                    if (handler) {
                        e.preventDefault();
                        handler();
                    }
                });
            }

            getKeyString(e) {
                const parts = [];
                
                if (e.metaKey) parts.push('cmd');
                if (e.ctrlKey) parts.push('ctrl');
                if (e.altKey) parts.push('alt');
                if (e.shiftKey) parts.push('shift');
                
                const key = e.key.toLowerCase();
                if (key !== 'control' && key !== 'alt' && key !== 'shift' && key !== 'meta') {
                    parts.push(key === ' ' ? 'space' : key);
                }
                
                return parts.join('+');
            }

            focusSearch() {
                const searchInput = document.querySelector('.search-input');
                if (searchInput) {
                    searchInput.focus();
                    searchInput.select();
                }
            }

            toggleCommandPalette() {
                // Show command palette
                this.showCommandPalette();
            }

            showCommandPalette() {
                // This functionality requires a modal that can be dynamically filled.
                // For now, we'll just log it.
                console.log("Command Palette toggled");
                showToast('Info', 'Command Palette not yet implemented.', 'info');
            }

            filterCommands(query) {
                const items = document.querySelectorAll('.command-item');
                items.forEach(item => {
                    const text = item.textContent.toLowerCase();
                    item.style.display = text.includes(query.toLowerCase()) ? 'flex' : 'none';
                });
            }

            switchTab(tabName) {
                const tab = document.querySelector(`[data-tab="${tabName}"]`);
                if (tab) {
                    switchNavTab(tabName);
                }
            }

            runPrompt() {
                // Run current prompt
                const activePrompt = document.querySelector('.prompt-item.active');
                if (activePrompt) {
                    const promptId = activePrompt.dataset.id;
                    uiRenderer.testPrompt(promptId);
                }
            }

            duplicateCurrentPrompt() {
                const activePrompt = document.querySelector('.prompt-item.active');
                if (activePrompt) {
                    uiRenderer.duplicatePrompt(activePrompt.dataset.id);
                }
            }

            deleteCurrentPrompt() {
                const activePrompt = document.querySelector('.prompt-item.active');
                if (activePrompt && confirm('Delete this prompt?')) {
                    promptManager.deletePrompt(activePrompt.dataset.id);
                    uiRenderer.renderPrompts();
                    showToast('Deleted', 'Prompt deleted successfully', 'info');
                }
            }

            closeModals() {
                const modal = document.getElementById('newPromptModal');
                if (modal && modal.classList.contains('active')) {
                    closeModal();
                }
            }

            toggleRightPanel() {
                const panel = document.querySelector('.right-panel');
                if (panel) {
                    toggleRightPanel();
                }
            }
        }

        // Real-time Search with Advanced Filters
        class SearchEngine {
            constructor() {
                this.searchIndex = [];
                this.filters = {
                    category: '',
                    tags: [],
                    dateRange: null,
                    sortBy: 'relevance'
                };
                this.init();
            }

            init() {
                this.buildSearchIndex();
                this.setupAdvancedSearch();
            }

            buildSearchIndex() {
                // Build search index from all prompts
                this.searchIndex = promptManager.getPrompts().map(prompt => ({
                    id: prompt.id,
                    name: prompt.name.toLowerCase(),
                    description: (prompt.description || '').toLowerCase(),
                    content: prompt.content.toLowerCase(),
                    category: (prompt.category || '').toLowerCase(),
                    tags: (prompt.tags || []).map(t => t.toLowerCase()),
                    created: new Date(prompt.created),
                    modified: new Date(prompt.modified)
                }));
            }

            search(query, filters = {}) {
                const normalizedQuery = query.toLowerCase();
                const mergedFilters = { ...this.filters, ...filters };
                
                let results = this.searchIndex.filter(item => {
                    // Text search
                    const textMatch = !normalizedQuery || 
                        item.name.includes(normalizedQuery) ||
                        item.description.includes(normalizedQuery) ||
                        item.content.includes(normalizedQuery) ||
                        item.tags.some(tag => tag.includes(normalizedQuery));
                    
                    if (!textMatch) return false;
                    
                    // Category filter
                    if (mergedFilters.category && item.category !== mergedFilters.category.toLowerCase()) {
                        return false;
                    }
                    
                    // Tags filter
                    if (mergedFilters.tags.length > 0) {
                        const hasAllTags = mergedFilters.tags.every(tag => 
                            item.tags.includes(tag.toLowerCase())
                        );
                        if (!hasAllTags) return false;
                    }
                    
                    // Date range filter
                    if (mergedFilters.dateRange) {
                        const { start, end } = mergedFilters.dateRange;
                        if (start && item.created < start) return false;
                        if (end && item.created > end) return false;
                    }
                    
                    return true;
                });
                
                // Sort results
                results = this.sortResults(results, normalizedQuery, mergedFilters.sortBy);
                
                // Map back to prompt objects
                return results.map(item => promptManager.getPromptById(item.id)).filter(p => p);
            }

            sortResults(results, query, sortBy) {
                switch(sortBy) {
                    case 'relevance':
                        return results.sort((a, b) => {
                            const scoreA = this.calculateRelevance(a, query);
                            const scoreB = this.calculateRelevance(b, query);
                            return scoreB - scoreA;
                        });
                    case 'name':
                        return results.sort((a, b) => a.name.localeCompare(b.name));
                    case 'created':
                        return results.sort((a, b) => b.created - a.created);
                    case 'modified':
                        return results.sort((a, b) => b.modified - a.modified);
                    default:
                        return results;
                }
            }

            calculateRelevance(item, query) {
                if (!query) return 0;
                
                let score = 0;
                if (item.name.includes(query)) score += 10;
                if (item.name.startsWith(query)) score += 5;
                if (item.description.includes(query)) score += 5;
                if (item.tags.some(tag => tag === query)) score += 8;
                if (item.content.includes(query)) score += 2;
                
                return score;
            }

            setupAdvancedSearch() {
                // Create advanced search UI
                const searchContainer = document.querySelector('.search-container');
                if (searchContainer) {
                    const advancedSearch = document.createElement('div');
                    advancedSearch.className = 'advanced-search';
                    advancedSearch.innerHTML = `
                        <div class="advanced-search-filters">
                            <div class="filter-group">
                                <label>Category</label>
                                <select class="filter-select" id="searchCategory">
                                    <option value="">All Categories</option>
                                    <option value="Code Generation">Code Generation</option>
                                    <option value="Writing">Writing</option>
                                    <option value="Data Analysis">Data Analysis</option>
                                    <option value="Translation">Translation</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Sort By</label>
                                <select class="filter-select" id="searchSort">
                                    <option value="relevance">Relevance</option>
                                    <option value="name">Name</option>
                                    <option value="created">Newest</option>
                                    <option value="modified">Recently Modified</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Tags</label>
                                <input type="text" class="form-control" id="searchTags" 
                                       placeholder="Enter tags, comma separated">
                            </div>
                            <div class="form-actions" style="border-top: none; padding-top: 0;">
                                <button class="btn btn-secondary" onclick="searchEngine.clearFilters()">
                                    Clear
                                </button>
                                <button class="btn btn-primary" onclick="searchEngine.applyFilters()">
                                    Apply
                                </button>
                            </div>
                        </div>
                    `;
                    
                    searchContainer.appendChild(advancedSearch);
                    
                    // Toggle advanced search on focus
                    const searchInput = searchContainer.querySelector('.search-input');
                    searchInput.addEventListener('focus', () => {
                        advancedSearch.classList.add('active');
                    });
                    
                    // Close on click outside
                    document.addEventListener('click', (e) => {
                        if (!searchContainer.contains(e.target)) {
                            advancedSearch.classList.remove('active');
                        }
                    });
                }
            }

            applyFilters() {
                const category = document.getElementById('searchCategory').value;
                const sortBy = document.getElementById('searchSort').value;
                const tags = document.getElementById('searchTags').value
                    .split(',')
                    .map(t => t.trim())
                    .filter(t => t);
                
                this.filters = { category, sortBy, tags };
                
                const query = document.querySelector('.search-input').value;
                const results = this.search(query);
                uiRenderer.renderPrompts(results);
                
                document.querySelector('.advanced-search').classList.remove('active');
            }

            clearFilters() {
                document.getElementById('searchCategory').value = '';
                document.getElementById('searchSort').value = 'relevance';
                document.getElementById('searchTags').value = '';
                
                this.filters = {
                    category: '',
                    tags: [],
                    dateRange: null,
                    sortBy: 'relevance'
                };
                
                uiRenderer.renderPrompts();
            }
        }

        // Initialize Advanced Features
        const autoSaveManager = new AutoSaveManager();
        const keyboardManager = new KeyboardManager();
        const searchEngine = new SearchEngine();

        // Performance Monitoring
        if ('PerformanceObserver' in window) {
            const perfObserver = new PerformanceObserver((list) => {
                for (const entry of list.getEntries()) {
                    if (entry.entryType === 'largest-contentful-paint') {
                        console.log('LCP:', entry.startTime);
                    }
                }
            });
            perfObserver.observe({ entryTypes: ['largest-contentful-paint'] });
        }

        // Add CSS for new features
        const styleSheet = document.createElement('style');
        styleSheet.textContent = `
            .command-palette {
                padding: var(--space-md);
            }
            
            .command-input {
                width: 100%;
                padding: var(--space-md);
                font-size: var(--text-lg);
                border: 1px solid var(--border);
                border-radius: var(--radius-md);
                margin-bottom: var(--space-md);
            }
            
            .command-list {
                max-height: 400px;
                overflow-y: auto;
            }
            
            .command-item {
                display: flex;
                align-items: center;
                gap: var(--space-sm);
                padding: var(--space-sm) var(--space-md);
                border-radius: var(--radius-md);
                cursor: pointer;
                transition: all var(--transition-fast);
            }
            
            .command-item:hover {
                background: var(--surface-hover);
            }
            
            .command-item kbd {
                margin-left: auto;
                padding: 2px 6px;
                background: var(--bg-tertiary);
                border: 1px solid var(--border);
                border-radius: var(--radius-sm);
                font-size: var(--text-xs);
                font-family: var(--font-mono);
            }
            
            .filter-group {
                margin-bottom: var(--space-md);
            }
            
            .filter-group label {
                display: block;
                margin-bottom: var(--space-xs);
                font-size: var(--text-sm);
                color: var(--text-secondary);
            }
            
            .auto-save-indicator.success {
                background: var(--success);
                color: white;
            }
            
            .auto-save-indicator.error {
                background: var(--danger);
                color: white;
            }
        `;
        document.head.appendChild(styleSheet);
    </script>
</body>
</html>
